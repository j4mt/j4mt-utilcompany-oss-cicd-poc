function clearRelated(e){$("input[class~="+e+"]:radio").removeAttr("checked"),$("input[class~="+e+"]:checkbox").removeAttr("checked"),$("input[class~="+e+"][type=text]").val(""),$("input[class~="+e+"][type=textarea]").val(""),$("select[class~="+e+"]").attr("selectedIndex","0").children("option:selected").removeAttr("selected")}function changeGraphPremise(e,t){var n=document.getElementById("selectPremiseId").value;document.location.href="billing-overview.htm?premiseId="+n+"&graphUnit="+e+"&graphPeriod="+t+"#graph"}function setClassOnAllBillRows(e,t){var n=document.getElementById(e),a=n.getElementsByTagName("tbody")[0],s=a.getElementsByTagName("tr");for(i=0;i<s.length;i++){var o=s[i].getElementsByTagName("td")[1],r=o.getElementsByTagName("a")[0];null!==r&&"Bill"==r.text&&(s[i].className=t)}}function updateCountyOptions(e){var t=document.getElementById("county");"N-I"==e.value?(t.disabled=!1,removeOption("DERRY",t),maybeAddOption("LONDONDERRY",t)):"ROI"==e.value?(t.disabled=!1,removeOption("LONDONDERRY",t),maybeAddOption("DERRY",t)):(t.value="",t.disabled=!0)}function removeOption(e,t){var n;for(n=0;n<t.length;n++)t.options[n].value==e&&t.remove(n)}function maybeAddOption(e,t){var n,a=document.createElement("option"),i=7,s=40;if(!optionExists(e,t))if(a.text=e,a.value=e,"LONDONDERRY"==e)try{n=t.options[s],t.add(a,n)}catch(o){t.add(a,s)}else if("DERRY"==e)try{n=t.options[i],t.add(a,n)}catch(o){t.add(a,i)}}function optionExists(e,t){for(i=0;i<t.length;i++)if(t.options[i].value==e)return!0;return!1}function resetPersonalDetails(){copyElementValueToAnotherElement("workPhoneNumber","workPhoneNumberOrig"),copyElementValueToAnotherElement("homePhoneNumber","homePhoneNumberOrig"),copyElementValueToAnotherElement("mobileNumber","mobileNumberOrig"),clearErrors("workPhoneNumber"),clearErrors("homePhoneNumber"),clearErrors("mobileNumber"),clearBlankContactForms(),clearContactFormErrors(),unmarkContactsForDeletion()}function resetBillingAddressDetails(){var e;clearBillingAddressFormErrors(),copyElementValueToAnotherElement("streetAddress","streetAddressOrig"),copyElementValueToAnotherElement("townCity","townCityOrig"),copyElementValueToAnotherElement("postcode","postcodeOrig"),copyElementValueToSelectElement("country","countryOrig"),copyElementValueToSelectElement("county","countyOrig"),e=copyElementValueToSelectElement("country","countryOrig").toLowerCase(),$("#county").closest(".row").hide(),$("#postcode").closest(".row").hide(),"northern_ireland"!==e&&"republic_of_ireland"!==e||$("#county").closest(".row").show(),"northern_ireland"!==e&&"united_kingdom"!==e||$("#postcode").closest(".row").show()}function resetMyAirtricityDetails(){copyElementValueToAnotherElement("username","usernameOrig"),copyElementValueToAnotherElement("customerEmailAddress","customerEmailAddressOrig"),document.getElementById("currentPassword").value="",document.getElementById("newPassword").value="",document.getElementById("newPasswordConfirmation").value="",clearErrors("username"),clearErrors("currentPassword"),clearErrors("newPassword"),clearErrors("newPasswordConfirmation"),clearErrors("customerEmailAddress")}function resetEBilling(){copyElementValueToAnotherElement("eBillingEmail","eBillingEmailOrig"),resetYesNoRadioButtons("eBillingYes","eBillingNo","eBillingSubscribedOrig","#eBillingEmailRow"),clearErrors("eBillingEmail")}function resetBillingNotification(){copyElementValueToAnotherElement("BillingNotEmail","BillingNotEmailOrig"),resetYesNoRadioButtons("BillingNotYes","BillingNotNo","billingNotificationSubscribedOrig","#billNotEmailRow"),clearErrors("BillingNotEmail")}function resetMeterReadingReminders(){copyElementValueToAnotherElement("meterSMSMobile","meterSMSMobileOrig"),copyElementValueToAnotherElement("meterEmailAddress","meterEmailAddressOrig"),resetYesNoRadioButtons("meterSMSYes","meterSMSNo","meterReadingReminderSmsSubscribedOrig","#meterSMSRow"),resetYesNoRadioButtons("meterEmailYes","meterEmailNo","meterReadingReminderEmailSubscribedOrig","#meterEmailRow"),clearErrors("meterSMSMobile"),clearErrors("meterEmailAddress")}function resetMarketingDetails(){resetYesNoRadioButtons("marketingYes","marketingNo","marketingInformationSubscribedOrig",null)}function resetYesNoRadioButtons(e,t,n,a){e=document.getElementById(e),t=document.getElementById(t),origValue=document.getElementById(n).value,"true"==origValue?(e.checked=!0,null!==a&&$(a).show()):(t.checked=!0,null!==a&&$(a).hide())}function copyElementValueToAnotherElement(e,t){document.getElementById(e).value=document.getElementById(t).value}function copyElementValueToSelectElement(e,t){var n=$("#"+e)[0].sumo,a=document.getElementById(t).value,i=$("#"+e).find('[value="'+a+'"]')[0];return i="undefined"!=typeof i?i.index||0:0,n.selectItem(i),$("#"+e).val()}function clearErrors(e){$("#"+e+"Error").remove(),$("#"+e).removeClass("invalidInput"),$("#"+e).parent().removeClass("error-row")}function onClickContactUs(){document.contactUs.submit()}function disableButtonAndDoSubmit(e,t){e.disabled=!0,t.submit()}function doSubmitWithValidation(e,t){$(t).valid()&&(e.disabled=!0,t.submit())}function clearBlankContactForms(){var e;$(".additional-contact-form + .additional-contact-form").each(function(){e=!0,$(this).find("input:text").each(function(){$(this).val().length>0&&(e=!1)}),e&&$(this).remove()})}function clearContactFormErrors(){$("#saveAdditionalContacts").length>0&&$("#saveAdditionalContacts").validate().resetForm()}function clearBillingAddressFormErrors(){$("#saveBillingAddressDetails .-error").removeClass("-error"),$("#saveBillingAddressDetails label.error").remove()}function unmarkContactsForDeletion(){$(".contacts-list").find(".delete-me").removeClass("delete-me").find("input").val("false")}function cookiesEnabled(){var e="test_cookie";return jQuery.cookie(e,!0),!!jQuery.cookie(e)&&(jQuery.cookie(e,null),!0)}function doAdmin(e,t){$("#"+e).submit(function(){return $("#"+e).attr("action",t),!0})}function doAdminFieldValue(e,t,n,a){$("#"+n).attr("value",a),$("#"+e).attr("action",t),$("#"+e).submit()}function doModificationUser(){$("#roleNameSelected").val($("#availableRoles").val()),$("#ossCoAdminUserModification").attr("action","oss-co-modify-user-seg.htm"),$("#ossCoAdminUserModification").submit()}function doModificationSegment(){var e="";$(".selectedPremice").each(function(){var t=$(this).attr("id");e+=t+","}),$("#selectedAccounts").val(e),$("#ossCoAdminSegmentModification").attr("action","oss-co-modify-segment-segments.htm"),$("#ossCoAdminSegmentModification").submit()}function doModificationSegmentDone(){var e="";$(".selectedPremice").each(function(){var t=$(this).attr("id");e+=t+","}),$("#ossCoAdminSegmentSegmentsModification").attr("action","oss-co-modify-segment-done.htm"),$("#ossCoAdminSegmentSegmentsModification").submit()}function doModificationUserNext(){$("#ossCoAdminUserModificationNext").attr("action","oss-co-modify-user-done.htm"),$("#ossCoAdminUserModificationNext").submit()}function doGoAsAccount(e,t,n,a){$("#"+t).val(e),$("#"+n).attr("action",a),$("#"+n).submit()}function doReadingsAsPremice(e,t,n,a,i,s,o,r){$("#"+a).val(e),$("#"+i).val(t),$("#"+s).val(n),$("#"+o).attr("action",r),$("#"+o).submit()}function doGoReportDelay(e){setTimeout(function(){doGoReport(e)},150)}function doGoReport(e){var t="";$("."+e).each(function(){if("checked"==$(this).attr("checked")){var e=$(this).attr("id");t+=e+","}});var n="";$(".reportType").each(function(){"checked"==$(this).attr("checked")&&(n=$(this).attr("id"))}),window.location.href="go-do-report.htm?reportingPremices="+t+"&start="+$("#datepickerStart").val()+"&end="+$("#datepickerEnd").val()+"&reportTypeSelected="+n}function retrieveReportName(){var e="",t="";return $(".reportType").each(function(){"checked"==$(this).attr("checked")&&(e=$(this).attr("id")),"DEFAULT"==e?t="Invoice Summary":"JOHNLYNN"==e?t="Interval Consumption":"CONSUMPTION"==e?t="Consumption":"MAXIMUMIMPORTCAPACITY"==e?t="Maximum Import Capacity":"TARIFF"==e&&(t="Cost Breakdown")}),t}function numberOfPrnsSelected(e){var t=0;return $("."+e).each(function(){"checked"==$(this).attr("checked")&&$("."+this.id).each(function(){t+=1})}),t}function numberOfPremisesSelected(e){var t=0;return $("."+e).each(function(){"checked"==$(this).attr("checked")&&(t+=1)}),t}function numberOfPremisesSelectedReport(e){var t=0;return $("."+e).each(function(){t+=1}),t}function prnMonths(e,t){var n=e*monthsRequested(t);return n}function monthsRequested(e){var t=e.startDayFormat.split("/"),n=e.endDayFormat.split("/"),a=new Date(t[2],t[1]-1,t[0]),i=new Date(n[2],n[1]-1,n[0]),s=0;return a&&i&&(s=Math.floor((i.getTime()-a.getTime())/864e5),s=Math.round(s/30)),s}function doGoGetReportDelay(e){setTimeout(function(){doGoGetReport(e)},150)}function doGoGetReport(e){var t="";$("."+e).each(function(){if("checked"==$(this).attr("checked")){var e=$(this).attr("id");t+=e+","}});var n="";$(".reportType").each(function(){"checked"==$(this).attr("checked")&&(n=$(this).attr("id"))}),$("#reportingPremices").val(t),$("#progressbarContainer").show("slow"),cookiesEnabled()&&(token=(new Date).getTime(),$("#dltokenvalueid").val(token)),$("#goCSVReportForm").attr("action","oss-co-do-csv-reports.htm?reportingPremices="+t+"&start="+$("#datepickerStart").val()+"&end="+$("#datepickerEnd").val()+"&dltokenval="+$("#dltokenvalueid").val()+"&extractType="+n),$("#goCSVReportForm").submit(),cookiesEnabled()&&trackDownload()}function trackDownload(){progressBarDisplay(""),fileDownloadCheckTimer=window.setInterval(function(){var e=$.cookie("fileDownloadToken");e==token&&finishDownload()},1e3)}function finishDownload(){window.clearInterval(fileDownloadCheckTimer),$.cookie("fileDownloadToken",null),$.unblockUI(),$("#progressbarContainer").hide("slow")}function doAddSubmitSuperGroupForm(){$("#addedUser").val($("#addedUserLocal").val()),$("#accountGroupsSelected").val($("#accountGroups").val()),$("#addSuperGroupForm").submit()}function doDelSubmitSuperGroupForm(){$("#selectedSuperGroupSGLocalDel").val($("#selectedSuperGroupSGLocalDelLocal").val()),$("#delSuperGroupForm").submit()}function doAddSuperGroupUserForm(){$("#addedUserSGUAdd").val($("#addedUserSGULocalAdd").val()),$("#selectedSuperGroupSGUAdd").val($("#selectedSuperGroupSGULocalAdd").val()),$("#addSuperGroupUserForm").submit()}function doDelSuperGroupUserForm(){$("#addedUserSGUDel").val($("#addedUserSGULocalDel").val()),$("#selectedSuperGroupSGUDel").val($("#selectedSuperGroupSGULocalDel").val()),$("#delSuperGroupUserForm").submit()}function doAddAccountGroupFromSuperGroupForm(){$("#selectedSuperGroupAdd").val($("#selectedSuperGroupLocalAdd").val()),$("#selectedAccountGroupAdd").val($("#selectedAccountGroupLocalAdd").val()),$("#addAccountGroupToSuperGroupForm").submit()}function doDelAccountGroupFromSuperGroupForm(){$("#selectedSuperGroupDel").val($("#selectedSuperGroupLocalDel").val()),$("#selectedAccountGroupDel").val($("#selectedAccountGroupLocalDel").val()),$("#delAccountGroupFromSuperGroupForm").submit()}function doAddPermissionForm(){$("#userNameAdd").val($("#userNameAddLocal").val()),$("#permissionAdd").val($("#permissionAddLocal").val()),$("#addPermissionForm").submit()}function doDelPermissionForm(){$("#userNameDel").val($("#userNameDelLocal").val()),$("#permissionDel").val($("#permissionDelLocal").val()),$("#delPermissionForm").submit()}function doAddUserForm(){$("#userNameAddUser").val($("#userNameAddUserLocal").val()),$("#passwordAddUser").val($("#passwordAddUserLocal").val()),$("#emailAddUser").val($("#emailAddUserLocal").val()),$("#roleAddUser").val($("#roleAddUserLocal").val()),$("#accountGroupIdAddUser").val($("#accountGroupIdAddUserLocal").val()),$("#addUserForm").submit()}function doSetRoleForm(){$("#userNameSetRole").val($("#userNameSetRoleLocal").val()),$("#roleSetRole").val($("#roleSetRoleLocal").val()),$("#setRoleForm").submit()}function doAddPortfolioForm(){$("#namePorAdd").val($("#namePorAddLocal").val()),$("#accountsPorAdd").val($("#accountsPorAddLocal").val()),$("#addPortfolioForm").submit()}function doDelPortfolioForm(){$("#idPorDel").val($("#idPorDelLocal").val()),$("#delPortfolioForm").submit()}function doAddAccountsToPortfolioForm(){$("#idPorAddAccnt").val($("#idPorAddAccntLocal").val()),$("#accountsAddAccnt").val($("#accountsAddAccntLocal").val()),$("#addAccountsToPortfolioForm").submit()}function doDelAccountsFromPortfolioForm(){$("#idPorDelAccnt").val($("#idPorDelAccntLocal").val()),$("#accountsPorDel").val($("#accountsPorDelLocal").val()),$("#delAccountsToPortfolioForm").submit()}function doAddPortfolioUserForm(){$("#idPorAddUser").val($("#idPorAddUserLocal").val()),$("#userNamePorAddUser").val($("#userNamePorAddUserLocal").val()),$("#addPortfolioUserForm").submit()}function doDelPortfolioUserForm(){$("#idPorDelUser").val($("#idPorDelUserLocal").val()),$("#userNamePorDelUser").val($("#userNamePorDelUserLocal").val()),$("#delPortfolioUserForm").submit()}function doGoAsAccountForm(e){$("#selectedAccount").val(e),$("#goAsAccountForm").submit()}function doReportsForAccounts(){window.location.href="charts-and-reports-debtornum-co.htm?accountsSelected="+$("#accountsSelectedForReport").val()}function doReportsConsForPremises(){window.location.href="reports-premise-cons.htm?premicesSelected="+$("#premisesSelectedForReport").val()}function doReportsCostForPremises(){window.location.href="reports-premise-cost.htm?premicesSelected="+$("#premisesSelectedForCostReport").val()}function progressBarDisplay(e){function t(){var i=n.progressbar("value")||0;n.progressbar("value",i+1),i<100&&(i>=75&&(a+=1700),"CONS_MULTISERIES_CONSENONINTERVAL"==e?timeOutCONS_MULTISERIES_CONSENONINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_COSTENONINTERVAL"==e?timeOutCONS_MULTISERIES_COSTENONINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_CONSEINTERVAL"==e?timeOutCONS_MULTISERIES_CONSEINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_COSTEINTERVAL"==e?timeOutCONS_MULTISERIES_COSTEINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_CONSGNONINTERVAL"==e?timeOutCONS_MULTISERIES_CONSGNONINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_COSTGNONINTERVAL"==e?timeOutCONS_MULTISERIES_COSTGNONINTERVAL=setTimeout(t,a):"ENONINTERVAL"==e?timeOutENONINTERVAL=setTimeout(t,a):"EINTERVAL"==e?timeOutEINTERVAL=setTimeout(t,a):"GNONINTERVAL"==e?timeOutGNONINTERVAL=setTimeout(t,a):timeOut=setTimeout(t,a))}var n=$("#progressbar"+e),a=($(".progress-label"),1e3);"CONS_MULTISERIES_CONSENONINTERVAL"==e?clearTimeout(timeOutCONS_MULTISERIES_CONSENONINTERVAL):"CONS_MULTISERIES_COSTENONINTERVAL"==e?clearTimeout(timeOutCONS_MULTISERIES_COSTENONINTERVAL):"CONS_MULTISERIES_CONSEINTERVAL"==e?clearTimeout(timeOutCONS_MULTISERIES_CONSEINTERVAL):"CONS_MULTISERIES_COSTEINTERVAL"==e?clearTimeout(timeOutCONS_MULTISERIES_COSTEINTERVAL):"CONS_MULTISERIES_CONSGNONINTERVAL"==e?clearTimeout(timeOutCONS_MULTISERIES_CONSGNONINTERVAL):"CONS_MULTISERIES_COSTGNONINTERVAL"==e?clearTimeout(timeOutCONS_MULTISERIES_COSTGNONINTERVAL):"ENONINTERVAL"==e?clearTimeout(timeOutENONINTERVAL):"EINTERVAL"==e?clearTimeout(timeOutEINTERVAL):"GNONINTERVAL"==e?clearTimeout(timeOutGNONINTERVAL):clearTimeout(timeOut),n.progressbar({value:!1,change:function(){n.progressbar("value")},complete:function(){}}),"CONS_MULTISERIES_CONSENONINTERVAL"==e?timeOutCONS_MULTISERIES_CONSENONINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_COSTENONINTERVAL"==e?timeOutCONS_MULTISERIES_COSTENONINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_CONSEINTERVAL"==e?timeOutCONS_MULTISERIES_CONSEINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_COSTEINTERVAL"==e?timeOutCONS_MULTISERIES_COSTEINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_CONSGNONINTERVAL"==e?timeOutCONS_MULTISERIES_CONSGNONINTERVAL=setTimeout(t,a):"CONS_MULTISERIES_COSTGNONINTERVAL"==e?timeOutCONS_MULTISERIES_COSTGNONINTERVAL=setTimeout(t,a):"ENONINTERVAL"==e?timeOutENONINTERVAL=setTimeout(t,a):"EINTERVAL"==e?timeOutEINTERVAL=setTimeout(t,a):"GNONINTERVAL"==e?timeOutGNONINTERVAL=setTimeout(t,a):timeOut=setTimeout(t,a)}function updateCagName(){var e=$("#cagName").val(),t=$("#cagId").val();$("#infoMessage").hide().removeClass("red"),$.ajax({url:"update-cag-name.htm",type:"post",async:!1,data:{cagName:e,cagId:t},success:function(e){e.indexOf("successfully")>-1?($("#infoMessage h3").text(e),$("#infoMessage").addClass("success-icon").fadeIn().removeClass("hide")):e.indexOf("DOCTYPE")>-1?($("#infoMessage h3").text("Sorry, something went wrong. Your session may have timed out. Please try again later."),$("#infoMessage").addClass("alert-icon red").fadeIn().removeClass("hide")):($("#infoMessage h3").text(e),$("#infoMessage").addClass("alert-icon red").fadeIn().removeClass("hide"))},error:function(){$("#infoMessage h3").text("Sorry, something went wrong. Please try again later."),$("#infoMessage").addClass("alert-icon red").fadeIn().removeClass("hide")}})}function updateSegName(){var e=$("#segName").val(),t=$("#segId").val();$("#infoMessage").hide().removeClass("red"),$.ajax({url:"update-segment-name.htm",type:"post",async:!1,data:{segName:e,segId:t},success:function(e){e.indexOf("successfully")>-1?($("#infoMessage h3").text(e),$("#infoMessage").addClass("success-icon").fadeIn().removeClass("hide")):e.indexOf("DOCTYPE")>-1?($("#infoMessage h3").text("Sorry, something went wrong. Your session may have timed out. Please try again later."),$("#infoMessage").addClass("alert-icon red").fadeIn().removeClass("hide")):($("#infoMessage h3").text(e),$("#infoMessage").addClass("alert-icon red").fadeIn().removeClass("hide"))},error:function(){$("#infoMessage h3").text("Sorry, something went wrong. Please try again later."),$("#infoMessage").addClass("alert-icon red").fadeIn().removeClass("hide")}})}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var a=Object(this),i=a.length>>>0;if(0===i)return-1;var s=+t||0;if(Math.abs(s)===1/0&&(s=0),s>=i)return-1;for(n=Math.max(s>=0?s:i-Math.abs(s),0);n<i;){if(n in a&&a[n]===e)return n;n++}return-1}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function(){},i=function(){return n.apply(this instanceof a?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),function(e,t,n){"use strict";var a=e.Component||function(){},i=a.nps=function(e,t){this.$el=$(e),this.$widgetEl=$(t),this.settings={sliderDefault:-1,feedbackVisible:!1,postUrl:"feedback.htm"},this.init(e)};i.prototype.init=function(e){this.bindUiActions(),this.clearSliders($(".feedback-form").find(".slider-container")),this.$widgetEl.length&&this.initWidget()},i.prototype.initWidget=function(){this.widget=new a.npsWidget(this.$widgetEl,this)},i.prototype.bindUiActions=function(){var e=this;$("#show-feedback").click(function(){e.settings.feedbackVisible?e.hideFeedback():e.showFeedback()}),$(".submit-success .close").click(function(){e.hideFeedback()}),$(".slider li a").click(function(){e.updateSlider($(this))}),$("#submit-feedback").click(function(t){t.preventDefault(),e.submitFeedback()})},i.prototype.submitFeedback=function(){var t=this,n={recommendationRating:$("#recommend").val(),satisfactionRating:$("#satisfied").val(),feedback:$("#comments").val(),sourceURL:e.location.href};t.validate(n)&&($.ajax({url:t.settings.postUrl,type:"POST",async:!0,dataType:"json",data:n}),t.showConfirmation())},i.prototype.showConfirmation=function(){var e=this;$("#feedback-container ul.tabs").slideUp("slow"),$(".feedback-form").slideUp("slow",function(){$(".submit-success").slideDown("slow"),e.widget&&e.widget.hide()})},i.prototype.updateSlider=function(e){var t=e.closest(".slider"),n=t.closest(".slider-container");t.children("li").removeClass("active"),e.closest("li").addClass("active"),n.next("input").val(e.text()),t.find("li a, li").removeClass("redraw"),n.removeClass("has-no-selection"),this.hideError(n.closest(".panel"))},i.prototype.showFeedback=function(){this.settings.feedbackVisible=!0,$("#feedback-container .feedback").slideDown("slow"),$("#show-feedback").addClass("minus")},i.prototype.hideFeedback=function(){this.settings.feedbackVisible=!1,$("#feedback-container .feedback").slideUp("slow"),$("#show-feedback").removeClass("minus")},i.prototype.clearSliders=function(e){e.each(function(){$(this).next("input").val(""),$(this).find(".active").removeClass("active"),$(this).addClass("has-no-selection")})},i.prototype.validate=function(e){var t={recommend:$("#recommend").closest(".panel"),satisfied:$("#satisfied").closest(".panel")};return!(!e.recommendationRating||!e.satisfactionRating)||(t.recommend.find(".slider-warning").remove(),e.recommendationRating?this.hideError(t.recommend):this.showError(t.recommend),t.satisfied.find(".slider-warning").remove(),void(e.satisfactionRating?this.hideError(t.satisfied):this.showError(t.satisfied)))},i.prototype.showError=function(e){var t="<p class='slider-warning'>Please select a rating below</p>";e.addClass("selection-warn"),e.find("h4").after(t)},i.prototype.hideError=function(e){e.removeClass("selection-warn"),e.find(".slider-warning").remove()},e.Component=a}(this.window,this.document),function(e){e(document).ready(function(){e(".pa-admin-area").length&&accountAdmin.init(),e("#segment-modification").length&&segmentAdmin.init()})}(jQuery);var segmentAdmin="undefined"==typeof segmentAdmin?{}:segmentAdmin;segmentAdmin={toBeRemoved:0,toBeAdded:0,linkClicked:!1,formSubmitted:!1,init:function(){this.navigateAwayCheck()},navigateAwayCheck:function(){$("a[href!=#]").not("a[href*=javascript], .btn.btn-save").on("click",function(){if(segmentAdmin.linkClicked=!0,segmentAdmin.toBeRemoved=$("input.existing[data-included=false]").length,segmentAdmin.toBeAdded=$("input[data-included=true]").not(".existing").length,segmentAdmin.toBeAdded>0||segmentAdmin.toBeRemoved>0){var e=$(this).attr("href");$(this).colorbox({inline:!0,transition:"none",href:function(){return"#navigate-away-modal"},width:function(){var e=$(this).attr("data-modal-width");return e?e+"px":"890px"},initialWidth:function(){var e=$(this).attr("data-modal-width");return e?e+"px":"890px"},scrolling:!1,onComplete:function(){$.colorbox.resize()}}),$("a.exit").on("click",function(){window.location.href=e}),$("a.close").on("click",function(){$.colorbox.close()})}else $.colorbox.remove()}),window.onbeforeunload=function(e){var t;if(e=e||window.event,"undefined"!=typeof e.explicitOriginalTarget?t=e.explicitOriginalTarget.nodeName.toLowerCase():"undefined"!=typeof e.target?t=e.target.activeElement.nodeName.toLowerCase():"undefined"!=typeof document.activeElement&&(t=document.activeElement.nodeName.toLowerCase()),"button"==t&&(segmentAdmin.linkClicked=!0),segmentAdmin.toBeRemoved=$("input.existing[data-included=false]").length,segmentAdmin.toBeAdded=$("input[data-included=true]").not(".existing").length,(segmentAdmin.toBeAdded>0||segmentAdmin.toBeRemoved>0)&&!segmentAdmin.linkClicked){var n="You have not saved your segment updates";return e&&(e.returnValue=n),n}}}};var accountAdmin="undefined"==typeof accountAdmin?{}:accountAdmin;accountAdmin={devMode:!1,segmentId:"",init:function(){accountAdmin.premisesCache=new PremisesCache,accountAdmin.accountsCache=new AccountsCache,accountAdmin.segmentId=$("#segId").val(),$("#pa-segments-tab-content").length&&(accountAdmin.variables.isGroup=!1,accountAdmin.preloadFirstPremises()),accountAdmin.bindUiActions(),accountAdmin.bindAddUndoUIActions(),accountAdmin.bindFilterUiActions(),accountAdmin.getPremisesCount({return_type:"premises"}),accountAdmin.setCurrentPremisesInSegment(),this.variables.fullGroups=[]},variables:{GrpDelTxt:"Remove group",SegDelTxt:"Remove segment",addAccTxt:"Add to group",remAccTxt:"Remove from group",remPremTxt:"Remove from segment",addPremTxt:"Add to segment",undoHtml:'<p class="added">Added<a href="#" class="add-to-group undo">Undo</a></p>',undoSegHtml:'<p class="added">Added<a href="#" class="add-to-segment undo">Undo</a></p>',undoGrpSegHtml:'<p class="added"><span class="accounts-added"></span><a href="#" class="add-all-matches undo">Undo</a></p>',undoAccSegHtml:'<p class="added">Added <span class="accounts-added"></span> matching premises<a href="#" class="add-all-matches undo">Undo</a></p>',removeInfoHtml:'<span class="bold">This account has been removed from this group:</span><br />',removeSegInfoHtml:'<span class="bold">This premises has been removed from this segment:</span><br />',undoPremFilterHtml:'<p class="added">Added <span class="accounts-added"></span> premises<a href="#" class="add-filtered-results undo">Undo</a></p>',undoRemovePremFilterHtml:'<p class="added">Removed <span class="accounts-added"></span> premises<a href="#" class="add-filtered-results undo remove">Undo</a></p>',isGroup:!0,segmentsWsUrl:"apiSegments.htm",premisesReturnLimit:10,activeQuery:!1,needToSave:!1,maxPremises:15,addingPremisesText:"Adding premises, please wait...",removingPremisesText:"Removing premises, please wait...",defaultLoadingText:"Please wait...",cachedFilteredPremises:!1,filteredPremisesToBeAdded:[]},getPremisesCount:function(e){$("#matches").hide();var t=this;$.ajax({url:accountAdmin.variables.segmentsWsUrl,type:"GET",dataType:"json",data:e}).done(function(e,n,a){a.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),"ok"===e.status&&(accountAdmin.updateTotalMatches(e.premises.length),t.variables.cachedFilteredPremises||(t.premisesCache.setUnfilteredPremisesCache(e.premises),t.variables.cachedFilteredPremises=!0)),"fail"!==e.status&&"error"!==e.status||$("#matches").hide()}).fail(function(){$("#matches").hide()})},checkFilteredPremisesExisting:function(){var e=!0,t=this.premisesCache.getPremisesCache("viewall");if(t.length>this.premisesCache.exisitingPremisesArray.length)e=!1;else for(var n=0;n<t.length;n++){var a=t[n];if(this.premisesCache.exisitingPremisesArray.indexOf(parseInt(a))===-1&&this.premisesCache.exisitingPremisesArray.indexOf(a)===-1){e=!1;break}}return e},checkFilteredPremisesToBeAdded:function(){var e,t=!0,n=this.premisesCache.getPremisesCache("viewall");if(e=this.premisesCache.getToBeAddedPremises().concat(this.premisesCache.exisitingPremisesArray),n.length>e.length)t=!1;else for(var a=0;a<n.length;a++)if(e.indexOf(parseInt(n[a]))===-1){t=!1;break}return t},checkFilteredPremisesToBeRemoved:function(){var e=!0,t=this.premisesCache.getPremisesCache("viewall"),n=[];if($.each($("input[data-included=false]"),function(){n.push($(this).val())}),t.length>n.length)e=!1;else for(var a=0;a<t.length;a++)if(n.indexOf(t[a])===-1){e=!1;break}return e},getFilteredPremises:function(e){var t={return_type:"premises"},n="all"===$("#premises-type").val()?null:$("#premises-type").val(),a="all"===$("#fuel-type").val()?null:$("#fuel-type").val(),i=$("#text-premises-filter").val();n&&(t.meter_type=n),a&&(t.fuel_type=a),i&&(t.search_text=i),$.ajax({url:accountAdmin.variables.segmentsWsUrl,type:"GET",dataType:"json",data:t}).done(function(t,n,a){a.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),"ok"===t.status&&e(t.premises),"fail"!==t.status&&"error"!==t.status||($("#matches").hide(),$("button.add-filtered-results").hide(),$("button.add-filtered-results").next("p.added").remove())}).fail(function(){$("#matches").hide(),$("button.add-filtered-results").hide(),$("button.add-filtered-results").next("p.added").remove()})},addFilteredPremisesSetToSegment:function(e){for(var t=this,n=[],a=0;a<e.length;a++){var i=e[a],s=i.premises_id;n.push(s)}var o="#viewall-premises";t.startLoading(o,accountAdmin.variables.addingPremisesText),setTimeout(function(){"undefined"!=typeof e&&e.length>0&&(t.addMultiplePremisesToSegment(n),t.checkForFullAccountsAndGroups(function(){t.endLoading(o)}))},10)},undoAddFilteredPremisesSetToSegment:function(e,t){if(t===!0){var n="#viewall-premises";this.startLoading(n,accountAdmin.variables.removingPremisesText)}var a,i=this,s=[];for(a=0;a<e.length;a++){var o=e[a].premises_id;s.push(o)}for(a=0;a<s.length;a++){var r=s[a];r=parseInt(r),i.premisesCache.exisitingPremisesArray.indexOf(r)===-1&&i.undoAddUnaddedPremisesToSegment(r,!1)}t===!0&&i.checkForFullAccountsAndGroups(function(){i.endLoading(n),$("button.add-filtered-results").next("p.added").remove(),$("button.add-filtered-results").show()});$(".existing-segment-accounts .pa-mprn-summary .premises-counter");i.showCounterOrPremisesRows()},removeFilteredPremisesSetFromSegment:function(e){for(var t=0;t<e.length;t++){var n=e[t].premises_id;this.removePremisesFromSegment(n)}this.applyPremisesViewAddAllButtonStyle()},undoRemoveFilteredPremisesSetFromSegment:function(e){for(var t=0;t<e.length;t++){var n=e[t].premises_id;this.undoRemovePremisesFromSegment(n)}$("button.add-filtered-results").next("p.added").remove(),$("button.add-filtered-results").show(),this.applyPremisesViewAddAllButtonStyle()},applyPremisesViewAddAllButtonStyle:function(){this.checkFilteredPremisesExisting()?$("#view-by .premises.active").length>0&&(""!==$("#text-premises-filter").val()||"all"!==$("#premises-type").val()||"all"!==$("#fuel-type").val())&&($("button.add-filtered-results").addClass("remove"),$("button.add-filtered-results span").text("Remove all from segment"),$("button.add-filtered-results").show(),$("button.add-filtered-results").next("p.added").remove(),accountAdmin.checkFilteredPremisesToBeRemoved()?($("button.add-filtered-results").hide(),$("button.add-filtered-results").after($(accountAdmin.variables.undoRemovePremFilterHtml)),this.updateTotalFilteredAdded("removed")):$("button.add-filtered-results").show()):$("#view-by .premises.active").length>0&&(""!==$("#text-premises-filter").val()||"all"!==$("#premises-type").val()||"all"!==$("#fuel-type").val())?($("button.add-filtered-results span").text("Add all to segment"),$("button.add-filtered-results").removeClass("remove"),$("button.add-filtered-results").show(),$("button.add-filtered-results").next("p.added").remove(),accountAdmin.checkFilteredPremisesToBeAdded()&&($("button.add-filtered-results").hide(),$("#infoMessageSegment").hide().removeClass("red"),$("button.add-filtered-results").after($(accountAdmin.variables.undoPremFilterHtml)),this.updateTotalFilteredAdded("added"))):$("button.add-filtered-results").hide()},updateTotalFilteredAdded:function(e){for(var t=this.premisesCache.getPremisesCache("viewall"),n=0,a=0;a<t.length;a++){var i=t[a];("added"===e&&this.premisesCache.exisitingPremisesArray.indexOf(parseInt(i))===-1&&this.premisesCache.exisitingPremisesArray.indexOf(i)===-1||"removed"===e&&(this.premisesCache.exisitingPremisesArray.indexOf(parseInt(i))>-1||this.premisesCache.exisitingPremisesArray.indexOf(i)>-1))&&n++}$(".save-updates .accounts-added").text(n)},updateTotalMatches:function(e){$("#matches span.total-matches").text(e),$("#matches").show()},addAccountToGroup:function(e,t){t?(e.closest("td").find('input[type="checkbox"]').prop("checked",!1),e.closest("td").find("a.add-to-group.btn").show(),e.closest("tr").removeClass("account-added"),e.closest("td").find("p").first().remove()):(e.closest("td").find('input[type="checkbox"]').prop("checked",!0),e.closest("td").find("a.add-to-group.btn").hide(),e.closest("tr").addClass("account-added"),e.closest("td").prepend(accountAdmin.variables.undoHtml))},removeAccountFromGroup:function(e){if(e.hasClass("undo")){var t=e.closest("tr").prev("tr");$(t).find('input[type="checkbox"]').prop("checked",!0),e.prev('input[type="checkbox"]').prop("checked",!0),e.removeClass("undo").text(accountAdmin.variables.remAccTxt).closest("tr").removeClass("account-removed"),e.closest("tr").remove(),$(t).show().css("visibility","visible"),$(".btn-save").removeClass("reflow")}else{var n=e.closest("tr").find("td:nth-child(4)").text(),a='<a class="btn btn-danger remove-from-group undo" href="#"><span>Undo</span></a>';e.closest("tr").after('<tr class="account-removed"><td colspan="4">'+accountAdmin.variables.removeInfoHtml+n+"</td><td>"+a+"</td></tr>"),e.closest("td").find('input[type="checkbox"]').prop("checked",!1),
e.closest("tr").hide().css("visibility","hidden"),$(".btn-save").removeClass("reflow")}},bindUiActions:function(){$("a.remove-group").click(function(){$(this).closest("tr").hasClass("danger")?accountAdmin.clearDelete($(this)):accountAdmin.confirmDelete($(this))}),$(".new-segment-accounts").on("click",".pa-dt-master-account-level a.pa-dt-toggle.ajax",function(e){e.preventDefault();var t=$(this).parents("div").attr("id");$(this).parents("div").attr("data-account-level");$(this).hasClass("pa-dt-toggle-active")?($("#"+t).find('div[data-account-level="account"]').each(function(){var e="scroll."+$(this).attr("id");$(window).off(e)}),$(this).removeClass("pa-dt-toggle-active"),$('[data-owner="'+t+'"]').slideUp(function(){$(this).remove(),$(".lt-ie9 .btn").removeClass("reflow")}),$('div[id="'+t+'"]').removeClass("pa-row-open")):accountAdmin.getAccounts($(this).closest("div").attr("id"),function(){$("#"+t+" a.pa-dt-toggle").first().addClass("pa-dt-toggle-active"),$('[data-owner="'+t+'"]').slideDown(function(){$(this).removeClass("hide"),$(".lt-ie9 .btn").removeClass("reflow")}),$('div[id="'+t+'"]').addClass("pa-row-open")})}),$(".new-segment-accounts").on("click",".pa-dt-group-account-level a.pa-dt-toggle.ajax",function(e){e.preventDefault();var t=$(this).parents("div").attr("id");$(this).parents("div").attr("data-account-level");$(this).hasClass("pa-dt-toggle-active")?($(this).removeClass("pa-dt-toggle-active"),$(window).off("scroll."+t),$('[data-owner="'+t+'"]').slideUp(function(){$(this).remove(),$(".lt-ie9 .btn").removeClass("reflow")}),$('div[id="'+t+'"]').removeClass("pa-row-open")):accountAdmin.getPremises($(this).closest("div").attr("id"),0,accountAdmin.variables.premisesReturnLimit-1,function(e,n){accountAdmin.appendPremises(e,n),$("#"+t+" a.pa-dt-toggle").addClass("pa-dt-toggle-active"),$('[data-owner="'+t+'"]').slideDown(function(){$(this).removeClass("hide"),$(".lt-ie9 .btn").removeClass("reflow")}),$('div[id="'+t+'"]').addClass("pa-row-open"),accountAdmin.reStyleRows(),accountAdmin.watchScroll('[data-owner="'+t+'"] table.stripe tbody tr:last-child',e)})}),$(".new-segment-accounts .btn-save").click(function(e){accountAdmin.updateSeg(),e.preventDefault()}),$(".add-segment-accounts .btn-save").click(function(e){$("#selectedPremises").val(accountAdmin.addSeg())}),$("#view-by .groups-and-accounts").click(function(e){$(this).hasClass("active")||($("#view-by .active").removeClass("active"),$(this).addClass("active"),active="#groups-and-accounts-view",leaving="#viewall-premises",accountAdmin.changeTab(active,leaving),accountAdmin.resetFilters())}),$("#view-by .premises").click(function(e){$(this).hasClass("active")||(active="#viewall-premises",leaving="#groups-and-accounts-view",accountAdmin.changeTab(active,leaving),accountAdmin.resetFilters())})},bindFilterUiActions:function(){var e;$("#premises-type").change(function(){accountAdmin.filterSearch(!1)}),$("#fuel-type").change(function(){accountAdmin.filterSearch(!1)}),$("#text-premises-filter").keyup(function(t){t.preventDefault(),void 0!==e&&clearTimeout(e),e=setTimeout(function(){accountAdmin.filterSearch(!1)},500)}),$("#text-premises-filter").keydown(function(e){13===e.keyCode&&e.preventDefault()})},reStyleRows:function(){$("table.stripe tbody tr:visible:even").children("td").addClass("even-row").removeClass("odd-row"),$("table.stripe tbody tr:visible:odd").children("td").addClass("odd-row").removeClass("even-row"),$(".paginate_button.previous").first().hasClass("disabled")&&$(".paginate_button.next").first().hasClass("disabled")?$(".dataTables_paginate span").hide():$(".dataTables_paginate span").show()},getAccounts:function(e,t){if(!accountAdmin.variables.activeQuery){accountAdmin.variables.activeQuery=!0;var n="#"+e;accountAdmin.startLoading(n,this.variables.defaultLoadingText);var a,i,s,o={group_id:e,return_type:"accounts"};accountAdmin.segmentId&&(o.seg_id=accountAdmin.segmentId),a&&(o.meter_type=a),i&&(o.fuel_type=i),s&&(o.search_text=s),$.ajax({url:accountAdmin.variables.segmentsWsUrl,type:"GET",dataType:"json",data:o}).done(function(n,a,i){if(i.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),"ok"===n.status)if(0===n.accounts.length)accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"No accounts match your selected filters"),t);else{newAccounts=[],accountIds=[];for(var s=0;s<n.accounts.length;s++)newAccounts.push(accountAdmin.accountsTemplate(n.accounts[s],e)),accountIds.push(n.accounts[s].account_id);accountAdmin.variables.activeQuery=!1,accountAdmin.buildAccountsCache(e,n.accounts),accountAdmin.appendAccounts(e,newAccounts,t)}"fail"===n.status&&accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"We're sorry, something went wrong"),t),"error"===n.status&&accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"We're sorry, the service is currently experiencing a problem, please try again later."),t)}).fail(function(){accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"We're sorry, the service is currently experiencing a problem, please try again later."),t)}).always(function(){accountAdmin.endLoading(n),accountAdmin.variables.activeQuery=!1})}},getPremisesInProgress:null,getPremises:function(e,t,n,a){var i,s=e,o=e.split("-");if(o.length>1?(e=o[1],i=o[0]):e=o[0],"undefined"!=typeof this.accountsCache&&"undefined"!=typeof i){var r=accountAdmin.accountsCache.getAccount(i,e);if(0===r.gas_premises&&0===r.electricity_premises)return void a(s,accountAdmin.noPremisesTemplate("There are no active premises associated with this account"))}this.getPremisesInProgress&&4!=this.getPremisesInProgress.readyState&&this.getPremisesInProgress.abort();var d="all"===$("#premises-type").val()?null:$("#premises-type").val(),c="all"===$("#fuel-type").val()?null:$("#fuel-type").val(),l=$("#text-premises-filter").val(),u={return_type:"premises"},m=!1;"viewall"!=e&&(u.account_id=e),d&&(u.meter_type=d,"all"!==d&&(m=!0)),c&&(u.fuel_type=c,"all"!==c&&(m=!0)),l&&(u.search_text=l,m=!0);var p=[];if("undefined"!=typeof this.premisesCache){var h=this.premisesCache.getFullPremisesCache(e);p=h.slice(t,n)}if(p.length>0){for(var f=[],g=0;g<p.length;g++)f.push(accountAdmin.premisesTemplate(p[g]));a(s,f)}else if(0===t){accountAdmin.variables.activeQuery=!0;var v="#"+e;0===$(v).length&&(v="div[account-id="+e+"]"),$("#"+e+"-premises").length&&(v="#"+e+"-premises"),accountAdmin.startLoading(v,this.variables.defaultLoadingText),this.getPremisesInProgress=$.ajax({url:accountAdmin.variables.segmentsWsUrl,type:"GET",dataType:"json",data:u,async:!0}).done(function(i,o,r){var d,c=[],l=[];if(r.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),"ok"===i.status)if(i.premises.length>0){for(n>i.premises.length&&(n=i.premises.length-1),d=t;d<n+1;d++){var u=i.premises[d];c.push(accountAdmin.premisesTemplate(u))}for(d=0;d<i.premises.length;d++)l.push(i.premises[d].premises_id);accountAdmin.buildPremisesCache(e,s,l),accountAdmin.premisesCache.setFullPremisesCache(e,i.premises),accountAdmin.variables.activeQuery=!1,a(s,c)}else accountAdmin.buildPremisesCache(e,s,l),accountAdmin.premisesCache.setFullPremisesCache(e,i.premises),accountAdmin.variables.activeQuery=!1,p=m?"No premises match your selected filters":"There are no active premises associated with this account",a(s,accountAdmin.noPremisesTemplate(p));else if("fail"===i.status)accountAdmin.variables.activeQuery=!1,a(s,accountAdmin.noPremisesTemplate("We're sorry, the service is currently experiencing a problem, please try again later."));else if("error"===i.status&&0===i.premises.length){accountAdmin.buildPremisesCache(e,s,l),accountAdmin.premisesCache.setFullPremisesCache(e,i.premises),accountAdmin.variables.activeQuery=!1;var p;p=m?"No premises match your selected filters":"We're sorry, the service is currently experiencing a problem, please try again later.",a(s,accountAdmin.noPremisesTemplate(p))}}).fail(function(){accountAdmin.variables.activeQuery=!1}).always(function(e,t,n){accountAdmin.endLoading(v)})}},appendAccounts:function(e,t,n){for(var a=0;a<t.length;a++){var i=t[a],s=$(i).attr("id");0===$("#"+s).length&&$("#"+e).append(i)}this.checkForFullAccountsAndGroups(function(){n()})},appendPremises:function(e,t){$("#"+e).append('<div id="'+e+'-premises" class="pa-mprn-summary hide" data-owner="'+e+'" data-account-level="mprn"><table class="stripe"><colgroup><col class="premises-col-type" /><col class="premises-col-mprn" /><col class="premises-col-address" /><col class="premises-col-interval" /><col class="premises-col-actions" /></colgroup><tbody></table></div>').find("table.stripe tbody").append(t),accountAdmin.checkForFullAccountsAndGroups()},appendMorePremises:function(e,t){$("#"+e+"-premises table.stripe tbody").append(t)},bindAddUndoUIActions:function(){var e=this;$(".new-segment-accounts, .existing-segment-accounts").on("click","a.add-to-segment",function(t){var n=$(t.target).hasClass("undo"),a=$(this).closest("tr").attr("data-premises-id");n?e.undoAddUnaddedPremisesToSegment(a,!0):e.addUnaddedPremisesToSegment(a),e.checkForFullAccountsAndGroups(),t.preventDefault()}),$(".new-segment-accounts, .existing-segment-accounts").on("click","a.remove-from-segment",function(t){var n=$(t.target).hasClass("undo")||$(t.target).parent("a").hasClass("undo"),a=$(this).closest("tr").attr("data-premises-id");n?e.undoRemovePremisesFromSegment(a):e.removePremisesFromSegment(a),e.checkForFullAccountsAndGroups(),e.applyPremisesViewAddAllButtonStyle(),t.preventDefault()}),$("td").on("click","a.add-to-group",function(t){t.preventDefault(),e.addAccountToGroup($(this),$(t.target).hasClass("undo"))}),$("table").on("click","a.remove-from-group",function(t){t.preventDefault(),e.removeAccountFromGroup($(this))}),$(".new-segment-accounts, .existing-segment-accounts").on("click","a.add-all-matches",function(e){e.preventDefault(),$(this).hasClass("undo")?accountAdmin.undoAddPremisesSetToSegment($(this)):accountAdmin.addPremisesSetToSegment($(this))}),$(".new-segment-accounts, .existing-segment-accounts").on("click",".add-filtered-results",function(e){e.preventDefault();var t=$(this);accountAdmin.getFilteredPremises(function(e){t.hasClass("remove")?t.hasClass("undo")?accountAdmin.undoRemoveFilteredPremisesSetFromSegment(e):accountAdmin.removeFilteredPremisesSetFromSegment(e):t.hasClass("undo")?accountAdmin.undoAddFilteredPremisesSetToSegment(e,!0):accountAdmin.addFilteredPremisesSetToSegment(e)})})},isInSegment:function(e){return!!e.hasClass("existing")},showRemovedStatus:function(e){return"true"==e.attr("data-included")},showAddedStatus:function(e){return!(!e.length||e.hasClass("existing"))},showUndoRemovedStatus:function(e){return"false"==e.attr("data-included")},applyRemovedStatusStyling:function(e){return e.find("a.add-to-segment").addClass("hide"),e},applyCanRemoveStatusStyling:function(e){return e.find("a.remove-from-segment.btn").addClass("hide"),e},applyAddedStatusStyling:function(e){return e.addClass("account-added"),e.find("a.add-to-segment.btn").addClass("hide"),e.find("a.remove-from-segment.btn").addClass("hide"),e.find("td:last-child").each(function(){0===$(this).children("p.added").length&&$(this).prepend(accountAdmin.variables.undoSegHtml)}),e},removeAddedStatusStyling:function(e){return e.removeClass("account-added"),e.find("a.add-to-segment.btn").removeClass("hide"),e.find("a.remove-from-segment.btn").addClass("hide"),e.find("p.added").remove(),e},applyCanAddStatusStyling:function(e){return e.find("a.remove-from-segment.btn").addClass("hide"),e},applyUndoRemoveStatusStyling:function(e){var t=e.find("td.address").text(),n=e.attr("data-premises-id"),a='<a class="btn btn-danger remove-from-segment undo" href="#"><span>Undo</span></a>',i=$('<tr class="account-removed" data-premises-id="'+n+'"><td colspan="4">'+accountAdmin.variables.removeSegInfoHtml+t+"</td><td>"+a+"</td></tr>");return e.addClass("removed").addClass("hide"),e.after(i),$("input#"+n).attr("data-included",!1),e},setPremisesStatus:function(e,t){return accountAdmin.isInSegment(e)?accountAdmin.showRemovedStatus(e)?accountAdmin.applyRemovedStatusStyling(t):accountAdmin.showUndoRemovedStatus(e)?accountAdmin.applyUndoRemoveStatusStyling(t):accountAdmin.applyCanRemoveStatusStyling(t):accountAdmin.showAddedStatus(e)?accountAdmin.applyAddedStatusStyling(t):accountAdmin.applyCanAddStatusStyling(t)},addAllSelectStylingAccount:function(e,t){if($accountDiv=$("#"+e),t>0){var n=$accountDiv.find(".btn.add-all-matches").hide(),a=n.parent();0===a.find("p.added").length&&(a.append(this.variables.undoAccSegHtml),n.parents("tr").attr("data-set",$accountDiv.attr("id")),n.parents("td").find(".accounts-added").text(t))}},removeAllSelectStylingAccount:function(e){$accountDiv=$("#"+e),"viewall"!==e&&($button=$accountDiv.find(".btn.add-all-matches").show(),$container=$button.parents("tr"),$container.find("p.added").length>0&&$container.find("p.added").remove())},addZeroStylingAccount:function(e){$("#"+e).find(".add-all-matches").hide()},addAllSelectStylingGroup:function(e,t,n,a,i){$groupDiv=$("#"+e);var s=$groupDiv.find("tr.pa-dt-master-account-level .btn.add-all-matches");s.hide();var o=s.parent();if(0===o.find(".accounts-added").length&&o.append(this.variables.undoGrpSegHtml),o.find(".accounts-added").length>0){var r,d=function(){return parseInt(e)===parseInt(n)},c=d();r=a?i:c?"Added "+t+" matching premises":"Added "+t+" premises contained",o.find(".accounts-added").text(r)}},removeAllSelectStylingGroup:function(e){$groupDiv=$("#"+e),$groupDiv.removeClass("already-added"),"viewall"!==$groupDiv&&($button=$groupDiv.find("tr.pa-dt-master-account-level .btn.add-all-matches").show(),$container=$button.parent(),$container.find("p.added").length>0&&$container.find("p.added").remove())},addZeroStylingGroup:function(e){$("#"+e).find(".pa-dt-master-account-level .add-all-matches").hide()},getPremiseAddedCount:function(){return this.premisesCache.getToBeAddedPremises().length||0},showOrUpdateCounter:function(){var e=this.premisesCache.getToBeAddedPremises(),t=e.length;$(".existing-segment-accounts .pa-mprn-summary .account-added").remove();var n=$(".existing-segment-accounts .pa-mprn-summary .premises-counter span");if(0===n.length){var a='<tr class="pa-dt-mprn-level premises-counter"><td colspan="5"><p class="added">Added <span> '+t+" </span> Premises</p></td></tr>";$(".existing-segment-accounts .pa-mprn-summary table tbody").append(a)}else n.html(t)},removeCounter:function(){var e=$(".existing-segment-accounts .pa-mprn-summary .premises-counter");e.remove()},showPremisesRows:function(){var e=this.premisesCache.getToBeAddedPremises();$(".existing-segment-accounts .pa-mprn-summary .account-added, .existing-segment-accounts .pa-mprn-summary .premises-counter").remove();for(var t=0;t<e.length;t++){var n=e[t],a=this.premisesCache.getSinglePremises(n),i=this.premisesTemplate(a);$(".existing-segment-accounts .pa-mprn-summary table tbody").append(i),$dataPremises=$("[data-premises-id="+n+"]"),$existingPremises=$(".existing-segment-accounts").find($dataPremises),this.applyAddedStatusStyling($existingPremises),$(".existing-segment-accounts .pa-mprn-summary table tbody").append(i)}},addUnaddedPremisesToSegment:function(e){this.premisesCache.addToBeAddedPremises(e);var t=$("[data-premises-id="+e+"]"),n=$("#groups-and-accounts-view , #viewall-premises").find(t);n&&this.applyAddedStatusStyling(n),this.showCounterOrPremisesRows(),0===$("input[type=hidden]#"+e).length&&$(".existing-segment-accounts").append('<input type="hidden" data-included="true" id="'+e+'" value="'+e+'" />'),this.applyPremisesViewAddAllButtonStyle()},undoAddUnaddedPremisesToSegment:function(e,t){this.getPremiseAddedCount()<this.variables.maxPremises&&$('.existing-segment-accounts table tbody tr[data-premises-id="'+e+'"]').remove(),$(".existing-segment-accounts input#"+e).remove();var n=$("[data-premises-id="+e+"]"),a=$("#groups-and-accounts-view , #viewall-premises").find(n);$("#groups-and-accounts-view").find(n);accountAdmin.removeAddedStatusStyling(a),accountAdmin.premisesCache.removeToBeAddedPremises(e),t===!0&&this.showCounterOrPremisesRows(),this.applyPremisesViewAddAllButtonStyle()},removePremisesFromSegment:function(e){var t=$('tr[data-premises-id="'+e+'"]');if(0===t.filter(".account-removed").length){var n=t.first().find("td:nth-child(3)").text(),a='<a class="btn btn-danger remove-from-segment undo" href="#"><span>Undo</span></a>';t.after('<tr class="account-removed" data-premises-id="'+e+'"><td colspan="4">'+accountAdmin.variables.removeSegInfoHtml+n+"</td><td>"+a+"</td></tr>"),$("input#"+e).attr("data-included",!1),t.hide(),$(".lt-ie9 .btn").removeClass("reflow")}},undoRemovePremisesFromSegment:function(e){var t=$('tr[data-premises-id="'+e+'"].pa-dt-mprn-level');t.removeClass("account-removed"),t.find("a.add-to-segment").hide(),t.next("tr.account-removed").remove(),$("input#"+e).attr("data-included",!0),t.css("display","table-row"),$(".lt-ie9 .btn").removeClass("reflow")},getAccountIdFromDivId:function(e){var t;return"viewall"!==e?(t=e.split("-"),t=t[1]):t=e,t},getDivFromAccountId:function(e){var t;return t="viewall"!==e?$("div[id*='"+e+"'].pa-mprn-summary-container"):e},getGroupIdFromAccountId:function(e){var t=$("div[id*='-"+e+"']").attr("id");return"undefined"!=typeof t?(t=t.split("-"),t=t[0]):t="",t},fullAccountCheckInProgress:null,fullAccountGroupsCache:null,checkForFullAccountsAndGroups:function(e,t){this.fullAccountCheckInProgress&&4!=this.fullAccountCheckInProgress.readyState&&this.fullAccountCheckInProgress.abort();var n=["return_type=premhigher","seg_id="+accountAdmin.segmentId],a=accountAdmin.premisesCache.getToBeAddedPremises()||[];n.push("premise_list="+a.join(","));var i=this;a.length>0?this.fullAccountCheckInProgress=$.ajax({url:i.variables.segmentsWsUrl,data:n.join("&"),type:"POST",success:function(n,a,s){if(s.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),"ok"===n.status){i.fullAccountGroupsCache=n.groups;var o=function(a){i.resetGroupsAndAccountsDisplay();for(var s=n.groups,o=0;o<s.length;o++){for(var r=s[o],d=r.group_id,c=r.available_premises,l=0,u=r.accounts,m=0;m<u.length;m++){var p=u[m],h=p.available_premises,f=p.premises.length||0;l+=f;var g=d+"-"+p.account_id;f===h&&0!==f?i.addAllSelectStylingAccount(g,h):0===h?i.addZeroStylingAccount(g):i.removeAllSelectStylingAccount(g)}i.variables.fullGroups.indexOf(d);if(c===l&&0!==l){var v=!1,$=a[d];""!==$&&(v=!0),i.addAllSelectStylingGroup(d,l,t,v,$)}else i.removeAllSelectStylingGroup(d)}e&&e()},r={};$.each($("#groups-and-accounts-view").children("div"),function(){r[$(this).attr("id")]=$(this).find(".pa-dt-master-account-level .accounts-added").text()}),setTimeout(function(){o(r)},10)}}}):(i.resetGroupsAndAccountsDisplay(),e&&e())},resetGroupsAndAccountsDisplay:function(){for(var e=this,t=$("#groups-and-accounts-view>div"),n=0;n<t.length;n++){var a=t[n],i=$(a).attr("id");e.removeAllSelectStylingGroup(i);for(var s=e.accountsCache.getAccountsCache(i),o=0;o<s.length;o++){var r=s[o],d=i+"-"+r;e.removeAllSelectStylingAccount(d)}}},setCurrentPremisesInSegment:function(){var e=$("input.existing[data-included=true]"),t=[];$.each(e,function(){t.push($(this).val())}),this.premisesCache.setExisitingPremises(t)},buildPremisesCache:function(e,t,n){var a;"viewall"!==e?(a=t.split("-"),a=a[1]):a=e,this.premisesCache.setPremisesCache(e,n),this.premisesCache.setAlreadyAddedPremises(e),this.premisesCache.setNotAlreadyAddedPremises(e)},buildAccountsCache:function(e,t){accountAdmin.accountsCache.setAccountsCache(e,t)},premisesTemplate:function(e){if("undefined"!=typeof e){for(var t=e.utilities.length,n=[],a=[],i=[],s=$("input#"+e.premises_id),o=0;o<t;o++)n.push(e.utilities[o].type),a.push(e.utilities[o].extSdpCode),i.push(e.utilities[o].interval);var r=['<tr class="pa-dt-mprn-level" data-premises-id="'+e.premises_id+'">','<td class="meter-type">'+n.join("<br/>")+"</td>",'<td class="meter-number">'+a.join("<br/>")+"</td>",'<td class="address">'+e.address+"</td>",'<td class="interval">'+i.join("<br/>")+"</td>",'<td class="premises-admin align-right">','<a href="#" class="btn btn-medium add-to-segment">Add to segment</a>','<a href="#" class="btn btn-medium btn-danger remove-from-segment">Remove from segment</a>',"</td>","</tr>"],d=$(r.join(""));return d=this.setPremisesStatus(s,d)}},addedPremisesGroupTemplate:function(e){return'<tr class="account-added"><td></td><td colspan="4" class="text-right"><p class="added">Added <span id="added-premises-count">'+e+'</span> premises<a href="#" class="add-to-segment undo all">Undo</a></p></td></tr>'},updateAddedPremisesGroupTemplate:function(e){$("#added-premises-count").length?$("#added-premises-count").text(e):$(".existing-segment-accounts table.stripe").append(this.addedPremisesGroupTemplate(e))},noPremisesTemplate:function(e){return'<tr><td colspan="5" class="text-left">'+e+"</td></tr>"},accountsTemplate:function(e,t){var n=[t,"-",e.account_id].join(""),a=['<div id="',n,'" ','class="pa-mprn-summary-container pa-row-closed hide available-premises-account-',e.available_premises,'" ','data-owner="',t,'" ','data-account-level="account" ','account-id="',e.account_id,'" ','data-owner="',t,'" ',">","<table>","<colgroup>",'<col class="col-8">','<col class="col-4">',"</colgroup>","<tbody>",'<tr class="pa-dt-group-account-level">','<td class="pa-dt-account-details">','<a class="pa-dt-toggle ajax" href="#">Toggle</a>','<h4 class="account-name">',e.account_name,"</h4>",'<p class="account-meta">','<span class="elec-count">',e.electricity_premises,"</span> electric ",'<span class="gas-count">',e.gas_premises,"</span> Gas - Account ",'<span class="account-id">',e.account_id,"</span> ","</p>","</td>",'<td class="pa-admin-action-col last">','<a class="btn btn-medium add-all-matches" href="#">Add all matches to segment</a>',"</td>","</tr>","</tbody>","</table>","</div>"];if(accounts=a.join(""),parseInt(e.gas_premises)+parseInt(e.electricity_premises)===0&&$(accounts).find(".add-all-matches").hide(),$('tr[data-set="'+n+'"]').length){var i=$('tr[data-set="'+n+'"]').first().find("td.pa-admin-action-col").html();$(accounts).find(".pa-admin-action-col").html(i),$(accounts).find("tr").attr("data-set",n).find(".disabled").removeClass("disabled")}return accounts},noAccountsTemplate:function(e,t){var n=$('<div id="" class="pa-mprn-summary-container pa-row-closed hide" data-owner="'+e+'" data-account-level="account"><table><colgroup><col class="col-8"><col class="col-4"></colgroup><tbody><tr class="pa-dt-group-account-level"><td class="pa-dt-account-details" colspan="2"><p class="text-left">'+t+"</p></td></tr></tbody></table></div>");return n},watchScroll:function(e,t){$(window).on("scroll."+t,function(){var n=$(window).scrollTop(),a=$(e).offset().top,i=$(window).height(),s=.95;if(n/(a-i)>s){var o=$("#"+t+" table.stripe tr").length;"viewall"===t&&(o=$("#"+t+"-premises table.stripe tr:visible").length);var r=t.split("-"),d=r[1],c=accountAdmin.premisesCache.getPremisesCache(d).length;o===c||0===c?$(window).off("scroll."+t):accountAdmin.getPremises(t,o,o+(accountAdmin.variables.premisesReturnLimit-1),function(e,t){accountAdmin.appendMorePremises(e,t),accountAdmin.reStyleRows()})}})},addPremiseSelected:function(e){e.addClass("account-added"),e.find("a.add-to-segment.btn").addClass("hide"),e.find("a.remove-from-segment.btn").addClass("hide"),$.each(e.find("td:last-child"),function(){0===$(this).children("p.added").length&&$(this).prepend(accountAdmin.variables.undoSegHtml)})},removePremiseSelected:function(e){"undefined"!=typeof e&&(e.removeClass("account-added"),e.find("a.add-to-segment.btn").removeClass("hide"),e.each(function(){var e=$("input#"+$(this).attr("data-premises-id"));e.length>0?($(this).addClass("account-added"),$(this).find("a.add-to-segment.btn").addClass("hide")):$(this).find("td:last-child p.added").remove()}))},changeTab:function(e,t){var n,a;$("#view-by .active").removeClass("active"),"#groups-and-accounts-view"===t?($(".toggle .premises").addClass("active"),n=function(){$(t).find('div[data-account-level="account"]').each(function(){var e="scroll."+$(this).attr("id");$(window).off(e),$(this).remove()}),$(t).find(".pa-dt-toggle-active").removeClass("pa-dt-toggle-active")}):($("button.add-filtered-results").hide(),$("button.add-filtered-results").next("p.added").remove(),$(".toggle .groups-and-accounts").addClass("active"),n=function(){var e="scroll.viewall";$(window).off(e),$(t).find("table.stripe tr").slice(accountAdmin.variables.premisesReturnLimit-1,-1).remove()}),a="#groups-and-accounts-view"===e?function(){}:function(){var t=e+" table.stripe tbody tr:last-child";accountAdmin.watchScroll(t,"viewall")},$(t).hide(0,function(){n(),$(e).show(0,function(){a(),$(".lt-ie9 .btn").removeClass("reflow")})})},preloadFirstPremises:function(){accountAdmin.getPremises("viewall",0,accountAdmin.variables.premisesReturnLimit-1,function(e,t){accountAdmin.appendMorePremises(e,t),accountAdmin.reStyleRows()}),accountAdmin.variables.activeQuery=!1},resetFilters:function(){var e=$("#premises-type option:first-child").val(),t=$("#fuel-type option:first-child").val();$("#premises-type").val(e),$("#fuel-type").val(t),$("#text-premises-filter").val("").text(""),accountAdmin.filterSearch(!0)},filterSearch:function(e){$("button.add-filtered-results").next("p.added").remove();var t=this,n="all"===$("#premises-type").val()?null:$("#premises-type").val(),a="all"===$("#fuel-type").val()?null:$("#fuel-type").val(),i=$("#text-premises-filter").val();null!==n||null!==a&&$("#fuel-type option").length>1||""!==i?(accountAdmin.changeTab("#viewall-premises","#groups-and-accounts-view"),$("#view-by option:first").attr("selected","selected"),$("#view-by").attr("disabled","disabled")):($("#view-by").removeAttr("disabled"),accountAdmin.premisesCache&&accountAdmin.premisesCache.clearCache(),accountAdmin.accountsCache&&accountAdmin.accountsCache.clearCache()),e||(accountAdmin.premisesCache&&accountAdmin.premisesCache.clearCache(),accountAdmin.accountsCache&&accountAdmin.accountsCache.clearCache()),$("#viewall-premises").each(function(){var e="viewall";$(window).off("scroll.viewall");var n=function(e,n){if(t.variables.filteredPremisesToBeAdded=n,$("#viewall-premises table.stripe tr").fadeOut(function(){$(this).remove(),$(".lt-ie9 .btn").removeClass("reflow")}),accountAdmin.appendMorePremises(e,n),$("#viewall-premises table.stripe tr").not(".removed").fadeIn(function(){$(this).removeClass("hide"),$(".lt-ie9 .btn").removeClass("reflow")}),$("#viewall-premises").is(":visible")){var a="#viewall-premises table.stripe tbody tr:last-child";accountAdmin.watchScroll(a,"viewall"),n.indexOf("No premises match your selected filters")===-1?($("button.add-filtered-results").show(),accountAdmin.applyPremisesViewAddAllButtonStyle()):($("button.add-filtered-results").hide(),$("button.add-filtered-results").next("p.added").remove()),accountAdmin.reStyleRows()}};accountAdmin.getPremises(e,0,accountAdmin.variables.premisesReturnLimit-1,n)}),$(".new-segment-accounts .pa-mprn-summary-container").each(function(){$(window).off("scroll.viewall")});var s={return_type:"premises"};n&&(s.meter_type=n),a&&(s.fuel_type=a),i&&(s.search_text=i),accountAdmin.getPremisesCount(s)},adjustCount:function(e,t){if("undefined"!=typeof e&&"undefined"!=typeof t){var n=parseInt(e.text());"int"==typeof n&&e.text(n+t)}},addPremisesSetToSegment:function(e){if(e.parents(".pa-mprn-summary-container").length>0){var t=e.closest(".pa-mprn-summary-container").attr("account-id"),n=e.closest(".pa-mprn-summary-container").attr("id");this.addAccountSetToSegment(t,n)}else{var a=e.closest("div").attr("id");this.addAccountGroupSetToSegment(a)}},undoAddPremisesSetToSegment:function(e){if(e.parents(".pa-mprn-summary-container").length>0){var t=e.closest(".pa-mprn-summary-container").attr("account-id"),n=e.closest(".pa-mprn-summary-container").attr("id");this.undoAddAccountSetToSegment(t,n,!0)}else{var a=e.closest("div").attr("id");this.undoAddAccountGroupSetToSegment(a)}},addAccountSetToSegment:function(e,t){var n=this,a=n.premisesCache.getPremisesCache(e),i="#"+t;n.startLoading(i,accountAdmin.variables.addingPremisesText),setTimeout(function(){"undefined"!=typeof a&&a.length>0?(n.addMultiplePremisesToSegment(a),n.checkForFullAccountsAndGroups(function(){n.endLoading(i)})):accountAdmin.getPremises(t,0,10,function(t,a){var s=n.premisesCache.getPremisesCache(e);n.addMultiplePremisesToSegment(s),n.checkForFullAccountsAndGroups(function(){n.endLoading(i)})})},10)},undoAddAccountSetToSegment:function(e,t,n){if(n===!0){var a="#"+t;this.startLoading(a,accountAdmin.variables.removingPremisesText)}var i=this,s=accountAdmin.premisesCache.getPremisesCache(e);if(0===s.length)for(var o;o<i.fullAccountGroupsCache.length;o++)for(var r=i.fullAccountGroupsCache[o],d=(r.group_id,0);d<accounts.length;d++){var c=accounts[d];if(parseInt(e)===parseInt(c.account_id)){for(var l=c.premises,u=0;u<l.length;u++){var m=l[u];s.push(m.premise_id)}break}}var p=function(e){for(var t=0;t<e.length;t++){var s=e[t];s=parseInt(s),i.premisesCache.exisitingPremisesArray.indexOf(s)===-1&&i.undoAddUnaddedPremisesToSegment(s,!1)}n===!0&&i.checkForFullAccountsAndGroups(function(){i.endLoading(a)}),i.showCounterOrPremisesRows()};0===s.length?accountAdmin.getPremises(t,0,10,function(t,n){s=i.premisesCache.getPremisesCache(e),p(s)}):p(s)},addMultiplePremisesToSegment:function(e){if("undefined"!=typeof e)for(var t=0;t<e.length;t++){var n=parseInt(e[t]);this.premisesCache.exisitingPremisesArray.indexOf(n)===-1&&this.premisesCache.toBeAddedPremises.indexOf(n)===-1&&this.addUnaddedPremisesToSegment(n)}},addMultiplePremisesToSegmentNoCheck:function(e,t){var n=this;if("undefined"!=typeof e){var a=[],i=0,s=e.length,o=function(){for(;i<s;i++){var r=parseInt(e[i]),d=n.premisesCache.addToBeAddedPremises(r);if(d===!0){var c=$("[data-premises-id="+r+"]"),l=$("#groups-and-accounts-view , #viewall-premises").find(c);l&&n.applyAddedStatusStyling(l),a.push('<input type="hidden" data-included="true" id="'+r+'" value="'+r+'" data-premise-id="'+r+'" />')}i+1<s&&i%50===0?setTimeout(o,5):i+1==s&&(n.showCounterOrPremisesRows(),$(".existing-segment-accounts").append(a.join("")),t())}};o()}},showCounterOrPremisesRows:function(){var e=this;e.getPremiseAddedCount()>e.variables.maxPremises?e.showOrUpdateCounter():0===e.getPremiseAddedCount()?e.removeCounter():e.showPremisesRows()},addAccountGroupSetToSegment:function(e){var t="#"+e;this.startLoading(t,accountAdmin.variables.addingPremisesText),e=parseInt(e);var n=this;$.ajax({url:this.variables.segmentsWsUrl,type:"GET",async:!0,data:{group_id:e,return_type:"fullgroup"},success:function(a,i,s){if(s.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),"ok"===a.status){var o=a.accounts;n.accountsCache.setAccountsCache(e,o);for(var r=n.premisesCache.getExisitingPremisesArray(),d=[],c=0;c<o.length;c++){for(var l=o[c],u=l.account_id,m=l.premises||[],p=[],h=0;h<m.length;h++){var f=m[h],g=f.premises_id;r.indexOf(parseInt(g))===-1&&d.indexOf(parseInt(g))===-1&&(d.push(parseInt(g)),p.push(parseInt(g)))}n.premisesCache.setPremisesCache(u,p)}n.addMultiplePremisesToSegmentNoCheck(d,function(){n.checkForFullAccountsAndGroups(function(){n.endLoading(t)},e)})}else"fail"===a.status?accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"We're sorry, something went wrong"),callback):"error"===a.status&&accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"We're sorry, the service is currently experiencing a problem, please try again later."),callback)},error:function(){}})},undoAddAccountGroupSetToSegment:function(e){var t=this,n="#"+e;$(".existing-segment-accounts .pa-mprn-summary .premises-counter");t.startLoading(n,accountAdmin.variables.removingPremisesText),e=parseInt(e);var a=function(a){setTimeout(function(){for(var i=0;i<a.length;i++){var s=a[i];t.undoAddAccountSetToSegment(s,e+"-"+s,!1)}t.checkForFullAccountsAndGroups(function(){
t.endLoading(n),t.showCounterOrPremisesRows()})},10)};if(t.accountsCache.cachedAccounts[e]){var i=t.accountsCache.getAccountsCache(e);a(i)}else $.ajax({url:this.variables.segmentsWsUrl,type:"GET",async:!0,data:{group_id:e,return_type:"fullgroup"},success:function(n,i,s){if(s.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),"ok"===n.status){var o=n.accounts;t.accountsCache.setAccountsCache(e,o);for(var r=t.premisesCache.getExisitingPremisesArray(),d=[],c=[],l=0;l<o.length;l++){var u=o[l],m=u.account_id;c.push(m);for(var p=u.premises||[],h=[],f=0;f<p.length;f++){var g=p[f],v=g.premises_id;r.indexOf(parseInt(v))===-1&&d.indexOf(parseInt(v))===-1&&(d.push(parseInt(v)),h.push(parseInt(v)))}t.premisesCache.setPremisesCache(m,h)}a(c)}else"fail"===n.status?accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"We're sorry, something went wrong"),callback):"error"===n.status&&accountAdmin.appendAccounts(e,accountAdmin.noAccountsTemplate(e,"We're sorry, the service is currently experiencing a problem, please try again later."),callback)},error:function(){}})},confirmDelete:function(e){e.text("Cancel").closest("tr").addClass("danger")},clearDelete:function(e){var t=accountAdmin.variables.SegDelTxt;accountAdmin.variables.isGroup&&(t=accountAdmin.variables.GrpDelTxt),e.text(t).closest("tr").removeClass("danger")},startLoading:function(e,t){"#viewall-premises"===e?$(e+">table").before($('<div class="ajax-loading hide">'+t+"</div>")):$(e+">table").after($('<div class="ajax-loading hide">'+t+"</div>"))},endLoading:function(e){$(e).find(".ajax-loading").remove()},premisesInput:function(e,t,n,a){return $('<input type="'+t+'" />').attr({id:e,"data-included":"true",value:n,"data-set":a})},updateSeg:function(){var e=$("#segId").val(),t=$("input[data-included='true']"),n=t.map(function(){return $(this).attr("value")}),a=[];$.each(n,function(e,t){$.inArray(t,a)===-1&&a.push(t)});var i=a.toString();$("#infoMessageSegment").hide().removeClass("red"),$.ajax({url:"update-segment-premises.htm",type:"post",async:!0,data:{segId:e,segPremises:i},success:function(e,t,n){n.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut"),e.indexOf("successfully")>-1?(window.onbeforeunload=function(e){},window.location.href="admin-segments.htm"):e.indexOf("DOCTYPE")>-1?($("#infoMessage h3").text("Sorry, something went wrong. You're session may have timed out. Please try again later."),$("#infoMessage").addClass("alert-icon red").fadeIn().removeClass("hide")):($("#infoMessageSegment h3").text(e),$("#infoMessageSegment").addClass("alert-icon red").fadeIn().removeClass("hide"))},error:function(){$("#infoMessageSegment h3").text("Sorry, something went wrong. Please try again later."),$("#infoMessageSegment").addClass("alert-icon red").fadeIn().removeClass("hide")}})},addSeg:function(){var e,t,n,a;return e=$("input.premisesChecked:checkbox:checked"),t=e.map(function(){return $(this).attr("value")}),n=[],$.each(t,function(e,t){$.inArray(t,n)===-1&&n.push(t)}),a=n.toString()}},$(".form-details").length&&($("#moving-out").length||$(".form-details div.row:even").addClass("odd-row")),$(".form-stripe").length&&$(".form-stripe div.row:odd").addClass("odd-row"),$("table.stripe").length&&$(".module table.stripe tr:even td").addClass("odd-row"),$("table.stripe-only").length&&$(".module table.stripe-only tr:even td").addClass("odd-row"),$(".change").length&&($(".change").click(function(){return $(".form-details").slideUp(),$(".display-details").slideDown(),$(".change").show(),$(".cancel-change").hide(),$(this).siblings(".display-details").slideUp(),$(this).siblings(".form-details").slideDown(),$(this).hide(),$(this).siblings(".cancel-change").show(),$(".module").removeClass("open"),$(this).parents(".module").addClass("open"),!1}),$(".cancel a").click(function(){return $(this).parents(".form-details").slideUp(),$(this).parents().siblings(".display-details").slideDown(),$(this).parents().siblings(".change").show(),$(this).parents().siblings(".cancel-change").hide(),$(this).parents(".module").removeClass("open"),!1}),$(".cancel-change").click(function(){return $(this).siblings(".form-details").slideUp(),$(this).siblings(".display-details").slideDown(),$(this).hide(),$(this).siblings(".change").show(),$(this).parents(".module").removeClass("open"),!1}),$(".open").length&&($(".open").children(".module-content").children(".display-details").hide(),$(".open").children(".module-content").children(".form-details").show()),$("#change-my-details .change").click(function(){$("#security-warning").show()}),$("#change-my-details .cancel-change").click(function(){$("#security-warning").hide()}),$("#change-my-details .cancel a").click(function(){$("#security-warning").hide()}),$("#billing-notification .change").click(function(){$("#billing-text").hide()}),$("#billing-notification .cancel-change").click(function(){$("#billing-text").show()}),$("#billing-notification .cancel a").click(function(){$("#billing-text").show()}),$("#BillingNotNo").is(":checked")&&$("#billNotEmailRow").hide(),$("#BillingNotNo").click(function(){$("#billNotEmailRow").slideUp()}),$("#BillingNotYes").click(function(){$("#billNotEmailRow").slideDown()}),$("#eBillingNo").is(":checked")&&$("#eBillingEmailRow").hide(),$("#eBillingNo").click(function(){$("#eBillingEmailRow").slideUp()}),$("#eBillingYes").click(function(){$("#eBillingEmailRow").slideDown()}),$("#meterSMSNo").is(":checked")&&$("#meterSMSRow").hide(),$("#meterSMSNo").click(function(){$("#meterSMSRow").slideUp()}),$("#meterSMSYes").click(function(){$("#meterSMSRow").slideDown()}),$("#meterEmailNo").is(":checked")&&$("#meterEmailRow").hide(),$("#meterEmailNo").click(function(){$("#meterEmailRow").slideUp()}),$("#meterEmailYes").click(function(){$("#meterEmailRow").slideDown()}),$("#marketingNo").is(":checked")&&$("#marketing-contact").hide(),$("#marketingNo").click(function(){$("#marketing-contact").slideUp()}),$("#marketingYes").click(function(){$("#marketing-contact").slideDown()}),$("#marketingByPost").is(":checked")&&$("#marketingEmailRow").hide(),$("#marketingByPost").click(function(){$("#marketingEmailRow").slideUp()}),$("#marketingByEmail").click(function(){$("#marketingEmailRow").slideDown()}),$("#password-form").validate({rules:{userName:{required:!0,minlength:2},newPassword:{required:!0,minlength:4},retypenewPassword:{required:!0,minlength:4,equalTo:"#newPassword"},detailsEmailAddres:{required:!0,email:!0}},messages:{username:{required:"Please enter a username",minlength:"Your username must consist of at least 2 characters"},newPassword:{required:"Please provide a password",minlength:"Your password must be at least 4 characters long"},retypenewPassword:{required:"Please provide a password",minlength:"Your confirmation password must be at least 4 characters long",equalTo:"Your passwords don't match. Remember that passwords are case sensitive."},detailsEmailAddres:{required:"Please enter a valid email address",email:"Please enter a valid email address"}},errorPlacement:function(e,t){e.appendTo(t.parent(".row").prev(".error-row-description-inline")),$(t).parents(".row").prev(".error-row-description-inline").show()},highlight:function(e,t,n){$(e).addClass(t).removeClass(n),$(e).parents(".row").addClass("error-row"),$(e).parents(".row").prev(".error-row-description-inline").addClass("row")},unhighlight:function(e,t,n){$(e).removeClass(t).addClass(n),$(e).parents(".row").prev(".error-row-description-inline").removeClass("row"),$(e).parents(".row").removeClass("error-row")},showErrors:function(e,t){0===this.numberOfInvalids()&&$(".error-row-description-inline").hide(),this.defaultShowErrors()}})),$(document).ready(function(){$('[data-account-level="mprn"]').hide(),$('[data-account-level="group"]').addClass("pa-row-closed").css("display","none"),$('[data-account-level="account"]').addClass("pa-row-closed").css("display","none"),$('[data-account-level="master"]').addClass("pa-row-open"),$(".lt-ie9 .btn").removeClass("reflow"),$(".pa-dynamic-table table.stripe td:last-child").removeClass("align-right"),$(".pa-segment-table > div:odd").addClass("pa-odd-row"),$(".pa-segment-table > div:even").addClass("pa-even-row"),$(".pa-plt-details").hide(),$(".pa-dynamic-table").find("[checked]").attr("checked",!1),$(".pa-dynamic-table a.pa-dt-toggle").click(function(){if(!$(this).hasClass("ajax")){var e=$(this).parents("div").attr("id");$(this).parents("div").attr("data-account-level");return $(this).hasClass("pa-dt-toggle-active")?($(this).removeClass("pa-dt-toggle-active"),$('[data-owner="'+e+'"]').slideUp(function(){$(".btn").removeClass("reflow")}),$('div[id="'+e+'"]').removeClass("pa-row-open")):($(this).addClass("pa-dt-toggle-active"),$('[data-owner="'+e+'"]').slideDown(function(){$(".btn").removeClass("reflow")}),$('div[id="'+e+'"]').addClass("pa-row-open")),!1}}),$(".pa-dt-toggle-link").click(function(e){e.preventDefault();var t=$(this).parents("div").attr("id");$(this).parents("div").attr("data-account-level");$(this).hasClass("pa-dt-toggle-active")?($(this).removeClass("pa-dt-toggle-active"),$(this).html("View all premises"),$('[data-owner="'+t+'"]').slideUp(function(){}),$('div[id="'+t+'"]').removeClass("pa-row-open")):($(this).addClass("pa-dt-toggle-active"),$(this).html("Hide all premises"),$('[data-owner="'+t+'"]').slideDown(function(){}),$('div[id="'+t+'"]').addClass("pa-row-open"))}),$(".pa-account-select-table .select-all").click(function(e){var t="#"+$(this).parents("div").attr("id"),n=$(t).find("tr.pa-dt-mprn-level"),a=$(t).find("tr.pa-dt-account-level");$("tr.pa-dt-mprn-level").removeClass("row-selected"),$("tr.pa-dt-mprn-level input:checked").parents("tr").addClass("row-selected"),$(this).hasClass("all-selected")?($(t).find(".select-all").removeClass("all-selected"),n.each(function(){$(this).find(":checkbox").prop("checked",!1)}),a.each(function(){$(this).find(":checkbox").prop("checked",!1)})):($(t).find(".select-all").addClass("all-selected"),n.each(function(){$(this).find(":checkbox").prop("checked",!0)}),a.each(function(){$(this).find(":checkbox").prop("checked",!0)})),$(t).find(".select-all.master").each(function(){$(this).hasClass("all-selected")?$(this).text("Unselect all"):$(this).text("Select all")}),$(t).find(".select-all.group").each(function(){$(this).hasClass("all-selected")?$(this).text("Unselect all in this group account"):$(this).text("Select all in this group account")}),$(t).find(".select-all.premises").each(function(){$(this).hasClass("all-selected")?$(this).text("Unselect all premises"):$(this).text("Select all premises")}),e.preventDefault()}),$(".pa-dynamic-table :checkbox").click(function(){var e,t,n=$(this).parents("div").first().attr("id"),a=0;for($('[data-owner="'+n+'"]').find(":checkbox").attr("checked",this.checked),e=$(this).parents("div").first().attr("data-account-level"),t=$(this).closest('[data-account-level="'+e+'"]');void 0!==e&&a<10;)t.parents("div").first().find("div input:checked").length===t.parents("div").first().find("div input:checkbox").length?t.siblings("table").find(":checkbox").attr("checked",!0):t.siblings("table").find(":checkbox").attr("checked",!1),e=t.parents("div").first().attr("data-account-level"),t=$(this).closest('[data-account-level="'+e+'"]'),a++}),$(".pa-dynamic-table :checkbox.check-my-siblings").click(function(){$(this).closest("tbody").find(":checkbox").attr("checked",this.checked)}),$(".pa-dynamic-table a.pa-plt-toggle").click(function(){return $(this).hasClass("pa-plt-toggle-active")?($(this).removeClass("pa-plt-toggle-active"),$(this).parents("div.pa-plt-mprn").removeClass("pa-row-open").find("div.pa-plt-details").slideUp()):($(this).addClass("pa-plt-toggle-active"),$(this).parents("div.pa-plt-mprn").addClass("pa-row-open").find("div.pa-plt-details").slideDown()),!1});var e=$("div.pa-plt-mprn").length,t=5,n=t;$(".pa-plt-total-count").text(e),$(".pa-plt-dynamic-count").text("1-"+e),e>t&&($(".pa-plt-dynamic-count").text("1-"+t),$("div.pa-plt-mprn").hide(),$("div.pa-plt-mprn:lt("+t+")").show(),$(".pa-plt-next-link").html('<a class="pa-plt-show-next-n" href="#">show next '+t+"</a> "),$(".pa-plt-all-link").html('<a class="pa-plt-show-all" href="#">show all</a>'),$(".pa-plt-show-all").click(function(){return $(this).hasClass("pa-plt-show-all-active")?($(".pa-plt-show-all").removeClass("pa-plt-show-all-active").text("Show all"),$("div.pa-plt-mprn:gt("+t+")").slideUp(),$(".pa-plt-next-link").html('<a class="pa-plt-show-next-n" href="#">show next '+t+"</a> ")):($(".pa-plt-show-all").addClass("pa-plt-show-all-active").text("Show 10 at a time"),$("div.pa-plt-mprn").slideDown(),$(".pa-plt-previous-link, .pa-plt-next-link").empty()),!1}),$(".pa-plt-show-next-n").click(function(){var a=n+1;return $(".pa-plt-dynamic-count").text(a+"-"+(n+t)),$("div.pa-plt-mprn").slice(0,n).slideUp(),$("div.pa-plt-mprn").slice(n,n+=t).slideDown(),n>=e&&$(".pa-plt-next-link").empty(),n>t&&$(".pa-plt-previous-link").html('<a class="pa-plt-show-previous-n" href="#">show previous '+t+"</a> "),!1}),$(".pa-plt-show-previous-n").click(function(){var a=n-t+1;return $(".pa-plt-dynamic-count").text(a+"-"+n),$("div.pa-plt-mprn").slice(n,e).slideUp(),$("div.pa-plt-mprn").slice(n-t,n).slideDown(),n-=t,n<e&&$(".pa-plt-next-link").html('<a class="pa-plt-show-next-n" href="#">show next '+t+"</a> "),n<t&&$(".pa-plt-previous-link").empty(),!1}))});var AccountsCache=function(){this.cachedAccounts={},this.cachedFullAccounts={},this.notAlreadyAddedAccounts={},this.toBeAddedAccounts=[]};AccountsCache.prototype.setAccountsCache=function(e,t){this.cachedFullAccounts[e]=t;for(var n=[],a=0;a<t.length;a++)n.push(t[a].account_id);this.cachedAccounts[e]=n},AccountsCache.prototype.getFullAccountsCache=function(e){return this.cachedFullAccounts[e]||this.cachedFullAccounts[parseInt(e)]||[]},AccountsCache.prototype.getAccountsCache=function(e){return this.cachedAccounts[e]||this.cachedAccounts[parseInt(e)]||[]},AccountsCache.prototype.getValidAccountsCache=function(e,t){for(var n=this.cachedAccounts[e],a=[],i=0;i<n.length;i++){var s=n[i],o=t.getPremisesCache(s);o.length>0&&a.push(n)}return a},AccountsCache.prototype.getAccount=function(e,t){for(var n=this.getFullAccountsCache(e),a=0;a<n.length;a++)if(parseInt(n[a].account_id)===parseInt(t))return n[a]},AccountsCache.prototype.addToBeAddedAccounts=function(e){var t=this.toBeAddedAccounts.indexOf(e);t===-1&&this.toBeAddedAccounts.push(e)},AccountsCache.prototype.removeToBeAddedAccounts=function(e){var t=this.toBeAddedAccounts.indexOf(e);t>-1&&this.toBeAddedAccounts.splice(t,1)},AccountsCache.prototype.getToBeAddedAccounts=function(){return this.toBeAddedAccounts},AccountsCache.prototype.setNotAlreadyAddedAccounts=function(e){e=parseInt(e),this.notAlreadyAddedAccounts[e]=this.isNotExistingInGroup(e)},AccountsCache.prototype.getNotAlreadyAddedAccounts=function(e){return this.notAlreadyAddedAccounts[e]},AccountsCache.prototype.isNotAddedInGroup=function(e){var t,n,a=this.getToBeAddedAccountsGroup(e),i=this.getAccountsCache(e),s=[];if(i.length>=a?(t=i,n=a):(n=i,t=a),0==n.length)for(var o=t.length-1;o>=0;o--){var r=t[o];-1===n.indexOf(r)&&s.push(r)}else for(var o=0;o<t.length;o++)t.indexOf(n[o])==-1&&n[o]&&s.push(n[o]);return s},AccountsCache.prototype.getToBeAddedAccountsGroup=function(e){var t,n,a=this.getToBeAddedAccounts(),i=this.getAccountsCache(e),s=[];i.length>=a?(t=i,n=a):(n=i,t=a);for(var o=0;o<t.length;o++)for(var r=0;r<n.length;r++)t[o]==n[r]&&s.push(t[o]);return s},AccountsCache.prototype.clearCache=function(){this.cachedAccounts={},this.cachedFullAccounts={}},$(document).ready(function(){"use strict";function e(e){$(".tooltip");$(e).click(function(){var e=$(this).position(),t=e.left,n=e.top,a=$(this).width()/2;if(n=n+20+"px",t=t-170+a+"px",$(this).next(".tooltip").is(":visible"))$(".tooltip").fadeOut();else{$(".tooltip").hide();var i=$(this).attr("href"),s='<span class="tooltip"><span class="tooltip-top"></span><span class="tooltip-content"><a href="#" class="tooltip-close"><span>close</span></a>',o="</span></span>",r=s+$(i).html()+o;$(this).after(r),$(this).next(".tooltip").css({top:n,left:t}),$(".tooltip-close").click(function(){return $(".tooltip").fadeOut(),!1}),$(r).show()}return!1})}$(".toolTip").length&&($(".tooltip").hide(),e(".toolTip"))}),$(document).ready(function(){"use strict";if($("body.commercial").length&&$("input[type='image']").length){var e,t,n,a="-blue";$("input[type='image']").each(function(){var i=$(this);e=$(this).attr("src"),t=e.substr(-4),n=e.replace(t,a+t),$.get(n,function(){i.attr("src",n)})})}}),$(document).ready(function(){"use strict";!function(){$.colorbox&&($(".colorbox-trigger").colorbox({inline:!0,href:function(){return $(this).attr("data-modal-target")},width:function(){var e=$(this).attr("data-modal-width");return e?e+"px":"890px"},initialWidth:function(){var e=$(this).attr("data-modal-width");return e?e+"px":"890px"},scrolling:!1,onComplete:function(){$.colorbox.resize()}}),$(".colorbox-trigger").click(function(e){e.preventDefault()}))}()}),function(e){e.url={},e.extend(e.url,{_params:{},init:function(){var e="";try{e=(document.location.href.split("?",2)[1]||"").split("#")[0].split("&")||[];for(var t=0;t<e.length;t++){var n=e[t].split("=");n[0]&&(this._params[n[0]]=unescape(n[1]))}}catch(a){alert(a)}},param:function(e){return this._params[e]||""},paramAll:function(){return this._params}}),e.url.init()}(jQuery),$(document).ready(function(){"use strict";function e(){var e=navigator.userAgent.toLowerCase();return e.indexOf("msie")!=-1&&parseInt(e.split("msie")[1])}if("undefined"==typeof $.cookie)return!1;if($("#loginForm button#submitLogin").click(function(){$.cookie("vIeBanner")&&$.cookie("vIeBanner",null,{path:"/"})}),!$.cookie("vIeBanner")){var t=e();t!==!1&&t<9&&($(".browser-support-container").show(),$("#information-banner").hide())}$(".dismiss-banner").click(function(e){e.preventDefault();var n=$(this).attr("href"),a=$(this).data("banner-cookie");$("."+n).slideUp(),$.cookie(a,t,{path:"/"}),$.ajax({url:"/hideOutOfDateBrowserMessage",type:"POST",dataType:"json",data:{hidden:!0}})})}),function(e){"use strict";var t="undefined"==typeof t?{}:t,n="undefined"==typeof n?{}:n;n={pagingRows:30,startDate:new Date("01 Jan 2000"),endDate:new Date,DataTable:function(){if("undefined"!=typeof e.fn.DataTable){e.fn.dataTable.ext.search.push(function(t,a,i){var s=n.startDate,o=n.endDate,r=new RegExp(e("#trans-type").val(),"i"),d=new Date(a[0])||0,c=a[4];return!(!(isNaN(s)&&isNaN(o)||isNaN(s)&&d<=o||s<=d&&isNaN(o)||s<=d&&d<=o)||!"all".match(r)&&!c.match(r))});var t=e("table#acc-history").DataTable({lengthChange:!1,displayLength:n.pagingRows,info:!1,sort:!1,searching:!0,dom:'<"top-paging"p>t<"bottom-paging"p>',drawCallback:n.reStyleRows}),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e(".btn-date-filter").click(function(){e("input.date-range").val(n.startDate.getDate()+" "+a[n.startDate.getMonth()]+" "+n.startDate.getFullYear()+" - "+n.endDate.getDate()+" "+a[n.endDate.getMonth()]+" "+n.endDate.getFullYear()),e(".calendar-container").fadeOut(),t.draw()}),e("#trans-type").change(function(){e("#trans-type-bottom").val(e(this).val()),t.draw()}),e("#trans-type-bottom").change(function(){e("#trans-type").val(e(this).val()),t.draw()})}},DateRange:function(){e("#date-from div").datepicker({dateFormat:"dd/mm/yy",showOtherMonths:!1,maxDate:0,defaultDate:"-1m",hideIfNoPrevNext:!0,onSelect:function(){n.startDate=e("#date-from div").datepicker("getDate"),e("#date-to > div").datepicker("option","minDate",n.startDate)}}),e("#date-to div").datepicker({dateFormat:"dd/mm/yy",maxDate:0,defaultDate:0,showOtherMonths:!1,hideIfNoPrevNext:!0,onSelect:function(){n.endDate=e("#date-to div").datepicker("getDate"),e("#date-from > div").datepicker("option","maxDate",n.endDate)}}),e("table.stripe tbody tr").each(function(){e(this).attr("data-date",new Date(e(this).children("td").first().text()))}),e(".date-range").focus(function(){if(e(this).closest(".table-filters").hasClass("after-table")){var t=e("#acc-history_wrapper").height()+e(".table-filters").first().height()-e(".calendar-container").height();e(".calendar-container").addClass("over").css("top",t).fadeIn()}else e(".calendar-container").removeClass("over").css("top","100%").fadeIn()}),e(".calendar-container a.close").click(function(){e(".calendar-container").fadeOut()}),e("#trans-type-bottom, #trans-type").click(function(){e(".calendar-container").fadeOut()})},reStyleRows:function(){e("table.stripe tbody tr:visible:even").children("td").addClass("even-row").removeClass("odd-row"),e("table.stripe tbody tr:visible:odd").children("td").addClass("odd-row").removeClass("even-row"),e(".paginate_button.previous").first().hasClass("disabled")&&e(".paginate_button.next").first().hasClass("disabled")?e(".dataTables_paginate span").hide():e(".dataTables_paginate span").show()}},t={pagingRows:30,DataTable:function(){if("undefined"!=typeof e.fn.DataTable){e.fn.dataTable.ext.search.push(function(t,n,a){var i=e("#trans-type").val(),s=n[3],o=e("#fuel").val(),r=n[0];return!("All"!==i&&s!==i||"All"!==o&&r!==o)});var t=e("table#acc-manage-segments").DataTable({lengthChange:!1,displayLength:n.pagingRows,info:!1,sort:!1,searching:!0,dom:'<"top-paging"p>t<"bottom-paging"p>',drawCallback:n.reStyleRows});e("#trans-type").change(function(){t.draw()}),e("#fuel").change(function(){t.draw()}),e("#filter").keyup(function(n){e(this).val().length>1&&t.search(e(this).val()).draw()})}}},e(document).ready(function(){e("table#acc-history").length&&(n.DataTable(),n.DateRange());var t=e("#feedback-container");if(t){var a=e(".c-nps-widget")||null;new Component.nps(t,a)}})}(jQuery),$("html").addClass("js-enabled"),$(document).ready(function(){"use strict";function e(e){var t=$("#payment-card-type").parents("form"),n=$("#debtornum").text(),s=$(".card-fee-notice"),o=$(".card-fee"),r=$("#payment-card-type").val(),d=parseFloat($("#euro").val()),c=parseFloat($("#cent").val());isNaN(d)&&(d=0),isNaN(c)&&(c=0);var l=d+"."+i(c.toString()),u=$("#payment-form").find(".total .field .total span");e?(t.find(".card-fee").addClass("show"),$(".lt-ie8").length?(s.show(400),o.show(400)):(s.slideDown(400),o.slideDown(400)),$.ajax({url:"payment-processing.htm",async:!1,data:{paymentAmount:l,debtornum:n,card:r},success:function(e){var t=parseFloat(a($("#payment-form").find(".pay-total .pay-amount strong span").text())),n=$("#payment-form").find(".total .field .total span");$("#cardFee").text(e),$("#cardFee1").text(e),t+=parseFloat(e),n.text(t.toFixed(2))}})):(t.find(".card-fee").removeClass("show"),$(".lt-ie8").length?(s.hide(400),o.hide(400)):(s.slideUp(400),o.slideUp(400)),u.text(d+"."+i(c.toString())))}function t(){var t=$("#payment-card-type option:selected");e(!t.hasClass("no-charge"))}function n(){var e=$("#payment-form").find(".pay-total .pay-amount strong span"),n=$("#payment-form").find(".total .field .total span"),a=parseFloat($("#euro").val()),s=parseFloat($("#cent").val());isNaN(a)&&(a=0),isNaN(s)&&(s=0),e.text(a+"."+i(s.toString())),n.text(a+"."+i(s.toString())),$("#paymentAmount").val(a+"."+i(s.toString())),t()}function a(e){return e.replace(/[^\d.]/g,"")}function i(e){return e.length<2&&(e="0"+e),e}$("#SMSReminderNo").length&&($("#SMSReminderNo").is(":checked")&&$("#meter-mobile-number").hide(),$("#SMSReminderNo").click(function(){$("#meter-mobile-number").slideUp()}),$("#SMSReminderYes").click(function(){$("#meter-mobile-number").slideDown()})),$("#EmailReminderNo").length&&($("#EmailReminderNo").is(":checked")&&$("#meter-email").hide(),$("#EmailReminderNo").click(function(){$("#meter-email").slideUp()}),$("#EmailReminderYes").click(function(){$("#meter-email").slideDown()})),($("#pa-electricity-tab").length||$("#pa-gas-tab").length)&&($("li#pa-electricity-tab a").click(function(){return $("#gas-content").hide(),$("#electricity-content").show(),$("li#pa-gas-tab").removeClass("current"),$(this).parents("li").addClass("current"),!1}),$("li#pa-gas-tab a").click(function(){return $("#electricity-content").hide(),$("#gas-content").show(),$("li#pa-electricity-tab").removeClass("current"),$(this).parents("li").addClass("current"),!1}),$("li#pa-electricity-tab").hasClass("current")&&($("#electricity-content").show(),$("#gas-content").hide()),$("li#pa-gas-tab").hasClass("current")&&($("#electricity-content").hide(),$("#gas-content").show()),"gas"==$.url.param("type")&&($("#electricity-content").hide(),$("#gas-content").show(),$("li#pa-electricity-tab").removeClass("current"),$("li#pa-gas-tab").addClass("current"))),$(".tabs-module").length&&($("li#electricity").length?($("li#electricity").addClass("current"),$(".electricity-content").show(),$(".gas-content").hide(),$(".home-content").hide(),$("#electricity-content").show(),$("#gas-content").hide(),$("#home-content").hide()):$("li#gas").length?($("li#gas").addClass("current"),$(".electricity-content").hide(),$(".gas-content").show(),$(".home-content").hide(),$("#electricity-content").hide(),$("#gas-content").show(),$("#home-content").hide()):$("li#home").length&&($("li#home").addClass("current"),$(".electricity-content").hide(),$(".gas-content").hide(),$(".home-content").show(),$("#electricity-content").hide(),$("#gas-content").hide(),$("#home-content").show()),$("li#electricity a").click(function(){return $(".electricity-content").show(),$(".gas-content").hide(),$(".home-content").hide(),$("#electricity-content").show(),$("#gas-content").hide(),$("#home-content").hide(),$("li#gas").removeClass("current"),$("li#home").removeClass("current"),$(this).parents("li").addClass("current"),!1}),$("li#gas a").click(function(){return $(".electricity-content").hide(),$(".gas-content").show(),$(".home-content").hide(),$("#electricity-content").hide(),$("#gas-content").show(),$("#home-content").hide(),$("li#electricity").removeClass("current"),$("li#home").removeClass("current"),$(this).parents("li").addClass("current"),!1}),$("li#home a").click(function(){return $(".electricity-content").hide(),$(".gas-content").hide(),$(".home-content").show(),$("#electricity-content").hide(),$("#gas-content").hide(),$("#home-content").show(),$("li#electricity").removeClass("current"),$("li#gas").removeClass("current"),$(this).parents("li").addClass("current"),!1})),$(".view-breakdown").length&&$(".view-breakdown").click(function(){return $(this).parents("tr").hasClass("breakdown")?($(this).parents("tr").find(".show-breakdown").hide(),$(this).parents("tr").removeClass("breakdown"),!1):($(this).parents("tr").find(".show-breakdown").slideDown(),$(this).parents("tr").addClass("breakdown"),!1)}),$("#meterReadNo").is(":checked")&&$("#show-meter-reading").hide(),$("#meterReadYes").click(function(){$("#show-meter-reading").slideDown()}),$("#meterReadNo").click(function(){$("#show-meter-reading").slideUp()}),$("#occupantDetailsNo").is(":checked")&&$("#occupant-details-show").hide(),$("#occupantDetailsYes").click(function(){$("#occupant-details-show").slideDown()}),$("#occupantDetailsNo").click(function(){$("#occupant-details-show").slideUp()}),$("#moving-out").length&&($("#movingHouseClose").is(":checked")&&($("#close-your-account-row").show(),$("#moving-continue-row").show()),$("#movingHouseTransfer").is(":checked")&&($("#transfer-your-account-row").show(),$("#moving-continue-row").show()),$("#movingHouseClose").click(function(){$("#transfer-your-account-row").hide(),$("#close-your-account-row").slideDown(),$("#moving-continue-row").show()}),$("#movingHouseTransfer").click(function(){$("#close-your-account-row").hide(),$("#transfer-your-account-row").slideDown(),$("#moving-continue-row").show()})),$("#accordion_content").length>0&&$("#accordion_content .head").click(function(){return $(this).next().toggle("slow"),$(this).toggleClass("selected"),!1}).next().hide(),$(".rollover").hover(function(){$(this).attr("src",$(this).attr("src").split(".").join("-rollover."))},function(){$(this).attr("src",$(this).attr("src").split("-rollover.").join("."))}),$("tr.bill-row").hover(function(){$(this).addClass("highlight")},function(){$(this).removeClass("highlight")}),$(this).parents().siblings(".display-details").slideDown(),$("table.stripe td:last-child").addClass("align-right"),$("table.stripe th:last-child").addClass("align-right"),$("table.stripe tr:last-child td").css("border-bottom","1px solid #d3d3d3"),$("table.stripe-only td:last-child").addClass("align-left"),$("table.stripe-only th:last-child").addClass("align-left"),$("table.stripe-only tr:last-child td").css("border-bottom","1px solid #d3d3d3"),$("p#amount, p.bill-display").length&&$("p#amount, p.bill-display").each(function(){var e=$(this).children("span, strong").text();e=e.replace(/^\D+/,""),e=e.replace(/\,/g,""),e>999.99&&$(this).addClass("large-amount")});var s;if($("a.show-hide").length&&$("a.show-hide").click(function(){return $(this).hasClass("show-hide-open")?(s=$(this).attr("href"),$("#"+s).slideUp(),$(this).removeClass("show-hide-open")):(s=$(this).attr("href"),$("#"+s).slideDown(),$(this).addClass("show-hide-open")),!1}),$("a.show-hide-2").length&&$("a.show-hide-2").click(function(){return $(this).hasClass("show-hide-2-open")?(s=$(this).attr("href"),$("#"+s).slideUp(),$(this).removeClass("show-hide-2-open")):(s=$(this).attr("href"),$("#"+s).slideDown(),$(this).addClass("show-hide-2-open")),!1}),$(".half-module").length){var o=0;$(".dashboard .half-module .module-content").each(function(e){$(this).height()>o&&(o=$(this).height())}),$(".dashboard .half-module .module-content").height(o)}if($("#payment-form .pay-total .pay-amount strong span").length&&n(),$("#euro").length&&($("#euro").keyup(function(){n()}),$("#euro").change(function(){n()})),$("#cent").length&&($("#cent").keyup(function(){n()}),$("#cent").change(function(){n()})),$(".money").focus(function(){"00"==$(this).val()&&$(this).val("")}),$(".money").blur(function(){""===$(this).val()&&$(this).val("00")}),$(".account-number").focus(function(){"last 10 digits of your card"==$(this).val()&&$(this).val("")}),$(".number-only").keyup(function(){this.value=this.value.replace(/[^0-9]/g,"")}),$(".epp").hide(),$(".account").blur(function(){var e=$("#debtornum").val();$.ajax({url:"checkIsEpp.htm",async:!1,data:{debtornum:e},success:function(e){"1"===e&&($(".not-epp").slideUp(400),$(".epp").slideDown(400))}})}),$("#payment-card-type").length){var r=$(".card-fee-notice");r.hide(),$("#payment-card-type").change(function(){t()})}$(".option").click(function(){$(this).parents(".row").find("input.mprn-or-gprn").prop("readonly",!0).addClass("disabled").val(""),$(this).parents(".field").find("input").prop("readonly",!1).removeClass("disabled").focus()}),$(".mprn-or-gprn").each(function(){var e=$(this).val();null!=e&&""!=e&&($(this).addClass("active"),$(this).parents(".field").find(".option").prop("checked",!0))}),$(".mprn-or-gprn").focus(function(){$(this).hasClass("active")||$(".mprn-or-gprn").val(""),$(".mprn-or-gprn").removeClass("active"),$(this).addClass("active"),$("input.mprn-or-gprn").prop("readonly",!0).addClass("disabled"),$(this).prop("readonly",!1).removeClass("disabled"),$(this).parents(".field").find("input.option").prop("checked",!0)}),($(".how-find-account").length||$(".how-find-mprn-or-gprn").length)&&($(".how-find-account").colorbox({inline:!0,href:"#how-find-account",width:"700px",height:"500px"}),$(".how-find-mprn-or-gprn").colorbox({inline:!0,href:"#how-find-mprn-or-gprn",width:"700px",height:"500px"})),$("#payment-form").length&&$(".error-msg").each(function(){$(this).parents("div.row").addClass("error")}),$("#submitBillNot").hasClass("disabled")&&$("#submitBillNot").attr("src","img/continuation-disabled.png"),$(".choice-country-payg").click(function(e){e.preventDefault(),$(".choice-country-payg").removeClass("active"),$(this).addClass("active"),$(".choice-supply-payg").removeClass("active"),$(".supply-choice .green-banner").slideUp(400),$(".continue-option").slideDown().find("a").addClass("disabled"),$(".continue-ni-gas-option").slideUp(400),$(".module.bill-pay").length&&$("#choice-roi").hasClass("active")?($(".continue-option").slideDown().find("button").removeClass("disabled").attr("id","submitBillNot"),
$(".continue-ni-gas-option").slideUp(400),$(".supply-choice").slideUp(400)):($(".continue-option").find("button").addClass("disabled").attr("id","submitBillNot"),$(".continue-ni-gas-option").slideUp(400),$(".supply-choice").slideDown(400))}),$(".choice-supply-payg").click(function(e){e.preventDefault(),$(".choice-supply-payg").removeClass("active"),$(this).addClass("active"),$("#choice-gas").hasClass("active")?$("#choice-ni").hasClass("active")?($(".supply-choice .green-banner.ni").slideDown(400),$(".continue-option").slideUp(400).find("button").addClass("disabled").attr("id","submitBillNot"),$(".continue-ni-gas-option").slideDown(400)):($(".supply-choice .green-banner.roi").slideDown(400),$(".continue-option").slideUp(400).find("button").addClass("disabled").attr("id","submitBillNot"),$(".continue-ni-gas-option").slideUp(400)):($(".supply-choice .green-banner").slideUp(400),$(".continue-option").slideDown(400).find("button").removeClass("disabled").attr("id","submitBillNot"),$(".continue-ni-gas-option").slideUp(400))}),$("#submitBillNot").click(function(e){$("#submitBillNot").hasClass("disabled")&&e.preventDefault()}),$(".pa-breadcrumbs-hidden-details").hide(),$("a.pa-breadcrumbs-show-details").toggle(function(){$(this).text("Hide details"),$(".pa-breadcrumbs-hidden-details").slideDown()},function(){$(this).text("Show details"),$(".pa-breadcrumbs-hidden-details").slideUp()}),$(".pa-breadcrumbs-hidden-details-elec").hide(),$("a.pa-breadcrumbs-show-details-elec").toggle(function(){$(this).text("Hide details"),$(".pa-breadcrumbs-hidden-details-elec").show("slow"),$(this).parent().parent().addClass("total")},function(){$(this).text("Show details"),$(".pa-breadcrumbs-hidden-details-elec").hide("slow"),$(this).parent().parent().removeClass("total")}),$(".pa-breadcrumbs-hidden-details-gas").hide(),$("a.pa-breadcrumbs-show-details-gas").toggle(function(){$(this).text("Hide details"),$(".pa-breadcrumbs-hidden-details-gas").show("slow"),$(this).parent().parent().addClass("total")},function(){$(this).text("Show details"),$(".pa-breadcrumbs-hidden-details-gas").hide("slow"),$(this).parent().parent().removeClass("total")}),$("#usage #chooseDifferentBill").change(function(){"custom-date-range"==$(this).val()&&$(this).parents("body").colorbox({inline:!0,width:"890px",height:"430px",href:"#pa_custom_date_range_inline"})}),jQuery.isFunction(jQuery.fn.datepicker)&&$("#pa-datepicker-container").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:3}),$("div.pa-usage-accordion div.pa-usage-accordion-content, div.pa-usage-content").hide(),$("div.pa-usage-content.pa-init-open").show(),$(".pa-usage-toggle").toggle(function(){return $(this).addClass("pa-usage-toggle-active"),$(this).parent().next("div").slideDown(),!1},function(){return $(this).removeClass("pa-usage-toggle-active"),$(this).parent().next("div").slideUp(),!1}),$(".pa-usage-accordion a.head").toggle(function(){return $(this).text("Hide consumption details").addClass("pa-usage-accordion-open selected"),$(this).next("div").slideDown(),!1},function(){return $(this).text("Show consumption details").removeClass("pa-usage-accordion-open selected"),$(this).next("div").slideUp(),!1}),$(".pa-usage-accordion-content table tr:nth-child(2)").addClass("pa-usage-row2"),$(".pa-inner-tabs a").click(function(){var e=$(this).attr("href");return $(".pa-inner-tab-content").hide(),$(".pa-inner-tabs li").removeClass("current"),$(this).parent().addClass("current"),$(e).show(),!1}),$(".pa-admin-add-user table.stripe tr:last-child td, .pa-usage-accordion-content table.stripe tr:last-child td, table.stripe.dotted-bottom tr:last-child td, .pa-mprn-summary-solo table tr:last-child td").css("border-bottom","1px dotted #d3d3d3"),$(".pa-admin-add-user table.stripe tr td:last-child").removeClass("align-right"),$(".pa-inline-reset, .pa-inline-delete").click(function(){var e=$(this).parents("tr").find("td:nth-child(1)").html(),t=$(this).parents("tr").find("td:nth-child(2)").html(),n=document.createElement("div");n.innerHTML=e;var a=n.firstChild.nodeValue;$(".pa-user-change-info").text(a+" ("+t+")")});var d=$(".pa-inline-reset, .pa-inline-delete");if(d.length>0&&$(".pa-inline-reset, .pa-inline-delete").colorbox({inline:!0,width:"580px"}),$(".pa-admin-account-details-edit, .pa-admin-account-save-action").hide(),$(".pa-admin-account-edit-action a").toggle(function(){return $(this).parents("tr").find(".pa-admin-account-details-edit").show(),$(this).parents("tr").find(".pa-admin-account-details").hide(),$(this).text("Save name"),!1},function(){var e=$(this).parents("tr").find(".pa-admin-account-details-edit input").val();return $(this).parents("tr").find(".pa-admin-account-details-edit").hide(),$(this).parents("tr").find(".pa-admin-account-details h4").text(e),$(this).parents("tr").find(".pa-admin-account-details").show(),$(this).text("Edit name"),!1}),$(".mod-meter-reading-summary").length){var c=$(".mod-meter-reading-summary").attr("data-api-endpoint");$.ajax({url:c,type:"GET",dataType:"json"}).done(function(e,t,n){n.responseText.indexOf("<!DOCTYPE html>")>-1&&window.location.replace("/oss_web/login.htm?login_error=timedOut");var a=e.meter_reading_summary;if(a.length){var i=$(".mod-meter-reading-summary .info-panel"),s=0;i.each(function(e){$(this).find("span").text(a[e]),s=$(this).outerHeight()>s?$(this).outerHeight():s}),$(".mod-meter-reading-summary").removeClass("loading"),i.outerHeight(s)}}).fail(function(){})}}),$(document).ready(function(){if($('button[onclick^="doSubmitWithValidation"]').click(function(e){e.preventDefault()}),$(".chat-box").length>0){var e=new Date,t=e.getDay(),n=e.getHours();0<t<6&&n>=9&&(n<17||17===n&&mins<=30)&&$(".chat-box").addClass("chat-available")}$(".triggerEgainChatClient").click(function(e){e.preventDefault();try{if(null!=eglvchathandle&&0==eglvchathandle.closed)return void eglvchathandle.focus()}catch(t){}var n="";n=encodeURIComponent(n);var a=encodeURIComponent(document.location.href),i=a.lastIndexOf("#");i!=-1&&(a=a.substring(0,i));var s=/eglvcaseid=[0-9]*/gi.exec(window.location.search),o="";if("undefined"!=typeof EGAINCLOUD&&EGAINCLOUD.Account.getAllIds){var r=EGAINCLOUD.Account.getAllIds();o="&aId="+r.a+"&sId="+r.s+"&uId="+r.u}var d=window.EG_CALL_Q||[];d.push(["enableTracker",!0]);var c=$(this).data("egain-channel"),l=$(this).data("egain-channel-id"),u=$(this).data("user-name"),m=$(this).data("user-email"),p=$(this).data("user-number"),h=$(this).data("egain-server"),f=h+"system/templates/chat/"+c+"/chat.html?subActivity=Chat&entryPointId="+l+"&templateName="+c+"&languageCode=en&countryCode=US&ver=v11&eglvrefname="+n+"&"+s+"&fieldname_1="+u+"&fieldname_2="+m+"&fieldname_3="+p+o;(f+a).length<=2e3&&(f+="&referer="+a);var g="height=680,width=420,resizable=no,scrollbars=no,toolbar=no";eglvchathandle=window.open(f,"",g)}),"input-row"==$(".invalidInput").parent().attr("class")?$(".invalidInput").parent().parent().addClass("error-row"):($(".invalidInput").parent().addClass("error-row"),$(".invalidRadio").parent().parent().addClass("error-row")),$(".invalidInput,.invalidRadio,.error-row").parents(".module").addClass("open"),$("#transfer-your-account-but").length&&$("#transfer-your-account-but").click(function(e){e.preventDefault(),$("#transfer-your-account-form").submit()});var a=window.navigator.userAgent,i=a.indexOf("MSIE ");window.sseIEVersion=parseInt(a.substring(i+5,a.indexOf(".",i)))});var fileDownloadCheckTimer,token,timeOut=0,timeOutCONS_MULTISERIES_CONSENONINTERVAL=0,timeOutCONS_MULTISERIES_COSTENONINTERVAL=0,timeOutCONS_MULTISERIES_CONSEINTERVAL=0,timeOutCONS_MULTISERIES_COSTEINTERVAL=0,timeOutCONS_MULTISERIES_CONSGNONINTERVAL=0,timeOutCONS_MULTISERIES_COSTGNONINTERVAL=0,timeOutENONINTERVAL=0,timeOutEINTERVAL=0,timeOutGNONINTERVAL=0,PremisesCache=function(){this.cachedPremises={},this.cachedFullPremises={},this.cachedUnfilteredPremises=[],this.toBeAddedPremises=[],this.toBeRemovedPremises={},this.alreadyAddedPremises={},this.notAlreadyAddedPremises={},this.exisitingPremisesArray=[]};PremisesCache.prototype.setPremisesCache=function(e,t){e=parseInt(e),this.cachedPremises[e]=t},PremisesCache.prototype.setFullPremisesCache=function(e,t){e=parseInt(e),this.cachedFullPremises[e]=t},PremisesCache.prototype.setUnfilteredPremisesCache=function(e){this.cachedUnfilteredPremises=e,console.log(this.cachedUnfilteredPremises)},PremisesCache.prototype.getPremisesCache=function(e){return this.cachedPremises[e]||this.cachedPremises[parseInt(e)]||[]},PremisesCache.prototype.getFullPremisesCache=function(e){return this.cachedFullPremises[e]||this.cachedFullPremises[parseInt(e)]||[]},PremisesCache.prototype.setExisitingPremises=function(e){for(var t=0;t<e.length;t++)this.exisitingPremisesArray.push(parseInt(e[t]))},PremisesCache.prototype.getExisitingPremisesArray=function(){return this.exisitingPremisesArray},PremisesCache.prototype.getSinglePremises=function(e){for(var t=0;t<this.cachedUnfilteredPremises.length;t++){var n=this.cachedUnfilteredPremises[t];if(parseInt(n.premises_id)===parseInt(e))return n}},PremisesCache.prototype.addToBeAddedPremises=function(e){e=parseInt(e);var t=this.toBeAddedPremises.indexOf(e);t===-1&&this.toBeAddedPremises.push(e)},PremisesCache.prototype.removeToBeAddedPremises=function(e){e=parseInt(e);var t=this.toBeAddedPremises.indexOf(e);t>-1&&this.toBeAddedPremises.splice(t,1)},PremisesCache.prototype.getToBeAddedPremises=function(){return this.toBeAddedPremises},PremisesCache.prototype.getToBeAddedPremisesAccount=function(e){if((e+"").indexOf("-")>-1){var t=e.split("-");e=t[1]}e=parseInt(e);var n,a,i=this.getToBeAddedPremises(),s=this.getPremisesCache(e),o=[];s.length>=i?(n=s,a=i):(a=s,n=i);for(var r=0;r<n.length;r++)for(var d=0;d<a.length;d++)parseInt(n[r])==parseInt(a[d])&&o.push(parseInt(n[r]));return o},PremisesCache.prototype.setToBeRemovedPremises=function(e,t){e=parseInt(e),t=parseInt(t),this.toBeRemovedPremises[e]=t},PremisesCache.prototype.getToBeRemovedPremises=function(e){return this.toBeRemovedPremises[e]||[]},PremisesCache.prototype.setAlreadyAddedPremises=function(e){e=parseInt(e),this.alreadyAddedPremises[e]=this.isExistingInAccount(e)},PremisesCache.prototype.getAlreadyAddedPremises=function(e){return this.alreadyAddedPremises[e]||[]},PremisesCache.prototype.setNotAlreadyAddedPremises=function(e){e=parseInt(e),this.notAlreadyAddedPremises[e]=this.isNotExistingInAccount(e)},PremisesCache.prototype.getNotAlreadyAddedPremises=function(e){return this.notAlreadyAddedPremises[e]},PremisesCache.prototype.isExistingInAccount=function(e){e=parseInt(e);var t,n,a=this.getExisitingPremisesArray(),i=this.getPremisesCache(e),s=[];i.length>=a?(t=i,n=a):(n=i,t=a);for(var o=0;o<t.length;o++)for(var r=0;r<n.length;r++)parseInt(t[o])==parseInt(n[r])&&s.push(parseInt(t[o]));return s},PremisesCache.prototype.isNotExistingInAccount=function(e){e=parseInt(e);var t,n,a=this.getExisitingPremisesArray(),i=this.getPremisesCache(e),s=[];if(i.length>=a?(t=i,n=a):(n=i,t=a),0==n.length)for(var o=t.length-1;o>=0;o--){var r=t[o];-1===n.indexOf(r)&&s.push(r)}else for(var o=0;o<t.length;o++)t.indexOf(n[o])==-1&&n[o]&&s.push(n[o]);return s},PremisesCache.prototype.clearCache=function(){this.cachedPremises={},this.cachedFullPremises={},this.notAlreadyAddedPremises={}};